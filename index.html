<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V-Wash Laundry - Online Booking System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="api-client.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --danger-color: #e74c3c;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background-color: white;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .logo-img {
            height: 50px;
            margin-right: 15px;
            border-radius: 8px;
            transition: var(--transition);
        }

        .logo-img:hover {
            transform: scale(1.05);
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 20px;
        }

        nav ul li a {
            text-decoration: none;
            color: var(--dark-color);
            font-weight: 500;
            transition: var(--transition);
            padding: 5px 10px;
            border-radius: 4px;
        }

        nav ul li a:hover {
            color: var(--primary-color);
            background-color: rgba(52, 152, 219, 0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }

        /* Main Content */
        main {
            flex: 1;
        }

        /* Section Styles */
        section {
            padding: 60px 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
            font-size: 2rem;
            color: var(--dark-color);
        }

        /* Auth Forms */
        .auth-container {
            display: flex;
            justify-content: center;
            margin-top: 40px;
        }

        .auth-form {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 450px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            text-align: center;
            text-decoration: none;
        }

        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .btn-secondary {
            background-color: #95a5a6;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        .btn-danger {
            background-color: var(--danger-color);
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .auth-switch {
            text-align: center;
            margin-top: 20px;
        }

        .auth-switch a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        /* Service Cards */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .service-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .service-image {
            height: 200px;
            background-size: cover;
            background-position: center;
        }

        .service-content {
            padding: 20px;
        }

        .service-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .service-description {
            margin-bottom: 15px;
            color: #7f8c8d;
        }

        .service-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        /* Booking Form */
        .booking-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 30px;
            margin-top: 40px;
        }

        .booking-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            width: 25%;
        }

        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 20px;
            right: -50%;
            width: 100%;
            height: 2px;
            background-color: #ddd;
            z-index: -1;
        }

        .step.active:not(:last-child)::after {
            background-color: var(--primary-color);
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #ddd;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
            z-index: 1;
        }

        .step.active .step-number {
            background-color: var(--primary-color);
        }

        .step.completed .step-number {
            background-color: var(--secondary-color);
        }

        .step-title {
            text-align: center;
            font-size: 0.9rem;
        }

        .booking-form-content {
            display: none;
        }

        .booking-form-content.active {
            display: block;
        }

        .date-time-picker {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .date-picker, .time-picker {
            flex: 1;
        }

        .address-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .address-form .form-group.full-width {
            grid-column: 1 / -1;
        }

        /* Order Summary */
        .order-summary {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .summary-row.total {
            font-weight: bold;
            font-size: 1.2rem;
            border-top: 1px solid #ddd;
            padding-top: 10px;
            margin-top: 10px;
        }

        /* Confirmation */
        .confirmation-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 30px;
            text-align: center;
            margin-top: 40px;
        }

        .confirmation-icon {
            font-size: 4rem;
            color: var(--secondary-color);
            margin-bottom: 20px;
        }

        .confirmation-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--dark-color);
        }

        .confirmation-message {
            margin-bottom: 30px;
            color: #7f8c8d;
        }

        .order-details {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            text-align: left;
            margin-bottom: 30px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .detail-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .detail-label {
            font-weight: 500;
        }

        /* Dashboard */
        .dashboard-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-top: 40px;
        }

        .dashboard-sidebar {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 30px;
        }

        .user-profile {
            text-align: center;
            margin-bottom: 30px;
        }

        .user-profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 2rem;
            font-weight: bold;
        }

        .user-profile-name {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .user-profile-email {
            color: #7f8c8d;
        }

        .dashboard-menu {
            list-style: none;
        }

        .dashboard-menu li {
            margin-bottom: 10px;
        }

        .dashboard-menu a {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border-radius: 5px;
            color: var(--dark-color);
            text-decoration: none;
            transition: var(--transition);
        }

        .dashboard-menu a:hover {
            background-color: #f8f9fa;
            color: var(--primary-color);
        }

        .dashboard-menu a.active {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary-color);
        }

        .dashboard-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .dashboard-content {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 30px;
        }

        .orders-list {
            margin-top: 20px;
        }

        .order-card {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .order-card:hover {
            box-shadow: var(--shadow);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .order-id {
            font-weight: 600;
        }

        .order-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-processing {
            background-color: #cce5ff;
            color: #004085;
        }

        .status-completed {
            background-color: #d4edda;
            color: #155724;
        }

        .order-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .order-actions {
            display: flex;
            gap: 10px;
        }

        .order-actions .btn {
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        /* Admin Dashboard */
        .admin-header {
            background-color: var(--dark-color);
            color: white;
            padding: 15px 0;
        }

        .admin-header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .admin-logo-img {
            height: 40px;
            margin-right: 15px;
            border-radius: 8px;
            transition: var(--transition);
        }

        .admin-logo-img:hover {
            transform: scale(1.05);
        }

        .admin-nav {
            display: flex;
            align-items: center;
        }

        .admin-nav a {
            color: white;
            text-decoration: none;
            margin-left: 20px;
            font-weight: 500;
            transition: var(--transition);
        }

        .admin-nav a:hover {
            color: var(--primary-color);
        }

        .admin-container {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        .admin-sidebar {
            width: 250px;
            background-color: #2c3e50;
            color: white;
            padding: 20px 0;
        }

        .admin-menu {
            list-style: none;
        }

        .admin-menu li {
            margin-bottom: 5px;
        }

        .admin-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: white;
            text-decoration: none;
            transition: var(--transition);
        }

        .admin-menu a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .admin-menu a.active {
            background-color: var(--primary-color);
        }

        .admin-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .admin-content {
            flex: 1;
            padding: 30px;
            background-color: #f5f7fa;
        }

        .admin-section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--dark-color);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 1.5rem;
        }

        .stat-icon.users {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary-color);
        }

        .stat-icon.orders {
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--secondary-color);
        }

        .stat-icon.revenue {
            background-color: rgba(241, 196, 15, 0.1);
            color: #f1c40f;
        }

        .stat-icon.pending {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
        }

        .stat-content h3 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .stat-content p {
            color: #7f8c8d;
        }

        .data-table {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background-color: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark-color);
        }

        .data-table td {
            padding: 15px;
            border-top: 1px solid #eee;
        }

        .data-table tr:hover {
            background-color: #f8f9fa;
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        .table-actions .btn {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        /* Database Status */
        .db-status {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .db-status-text {
            display: flex;
            align-items: center;
        }

        .db-status-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }

        .db-status-info h3 {
            margin-bottom: 5px;
        }

        .db-status-info p {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .db-actions {
            display: flex;
            gap: 10px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 350px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-icon {
            margin-right: 15px;
            font-size: 1.5rem;
        }

        .notification.success .notification-icon {
            color: var(--secondary-color);
        }

        .notification.error .notification-icon {
            color: var(--danger-color);
        }

        .notification.info .notification-icon {
            color: var(--primary-color);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .notification-message {
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .notification-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: #7f8c8d;
            cursor: pointer;
            margin-left: 10px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #7f8c8d;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Footer */
        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 40px 0 20px;
            margin-top: auto;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-section h3 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: white;
        }

        .footer-section p, .footer-section li {
            color: #bdc3c7;
            margin-bottom: 10px;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section a {
            color: #bdc3c7;
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-section a:hover {
            color: white;
        }

        .social-icons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .social-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: var(--transition);
        }

        .social-icon:hover {
            background-color: var(--primary-color);
            transform: translateY(-3px);
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
            text-align: center;
            color: #bdc3c7;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }

            .date-time-picker {
                flex-direction: column;
            }

            .address-form {
                grid-template-columns: 1fr;
            }

            .admin-container {
                flex-direction: column;
            }

            .admin-sidebar {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 15px;
            }

            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }

            nav ul li {
                margin: 5px;
            }

            .booking-steps {
                flex-wrap: wrap;
            }

            .step {
                width: 50%;
                margin-bottom: 20px;
            }

            .step:not(:last-child)::after {
                display: none;
            }

            .order-details {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .footer-content {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .social-icons {
                justify-content: center;
            }
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Main Site -->
    <div id="mainSite">
        <!-- Header -->
        <header>
            <div class="container header-container">
                <div class="logo">
                    <img src="logo.png" alt="V-Wash Laundry" class="logo-img">
                    <span>V-Wash Laundry</span>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link" data-page="home">Home</a></li>
                        <li><a href="#" class="nav-link" data-page="services">Services</a></li>
                        <li><a href="#" class="nav-link" data-page="booking">Book</a></li>
                        <li><a href="#" class="nav-link" data-page="dashboard">My Orders</a></li>
                    </ul>
                </nav>
                <div class="user-info hidden" id="userInfo">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <span id="userName">User</span>
                    <button class="btn btn-secondary" id="logoutBtn" style="margin-left: 15px;">Logout</button>
                </div>
                <div class="user-info" id="loginPrompt">
                    <button class="btn" id="loginBtn">Login/Register</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main>
            <!-- Home Page -->
            <section id="homePage" class="page">
                <div class="container">
                    <h1 class="section-title">V-Wash Laundry Service, Making Life Easier</h1>
                    <div class="services-grid" id="homeServicesGrid">
                        <!-- Services will be dynamically loaded here -->
                    </div>
                </div>
            </section>

            <!-- Services Page -->
            <section id="servicesPage" class="page hidden">
                <div class="container">
                    <h1 class="section-title">Our Services</h1>
                    <div class="services-grid" id="servicesPageGrid">
                        <!-- Services will be dynamically loaded here -->
                    </div>
                </div>
            </section>

            <!-- Booking Page -->
            <section id="bookingPage" class="page hidden">
                <div class="container">
                    <h1 class="section-title">Book Service</h1>
                    <div class="booking-container">
                        <div class="booking-steps">
                            <div class="step active" id="step1">
                                <div class="step-number">1</div>
                                <div class="step-title">Select Service</div>
                            </div>
                            <div class="step" id="step2">
                                <div class="step-number">2</div>
                                <div class="step-title">Pickup Info</div>
                            </div>
                            <div class="step" id="step3">
                                <div class="step-number">3</div>
                                <div class="step-title">Delivery Info</div>
                            </div>
                            <div class="step" id="step4">
                                <div class="step-number">4</div>
                                <div class="step-title">Confirm Order</div>
                            </div>
                        </div>

                        <!-- Step 1: Select Service -->
                        <div class="booking-form-content active" id="step1Content">
                            <h3>Select the service you need</h3>
                            <div class="form-group">
                                <label for="serviceType">Service Type</label>
                                <select class="form-control" id="serviceType">
                                    <option value="">Please select a service type</option>
                                    <!-- Services will be dynamically loaded here -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="itemCount">Number of Items</label>
                                <input type="number" class="form-control" id="itemCount" min="1" value="1">
                            </div>
                            <div class="form-group">
                                <label for="specialInstructions">Special Instructions</label>
                                <textarea class="form-control" id="specialInstructions" rows="3" placeholder="Please specify any special requirements"></textarea>
                            </div>
                            <div class="form-group">
                                <button class="btn" id="nextToStep2">Next</button>
                            </div>
                        </div>

                        <!-- Step 2: Pickup Information -->
                        <div class="booking-form-content" id="step2Content">
                            <h3>Pickup Information</h3>
                            <div class="date-time-picker">
                                <div class="date-picker">
                                    <label for="pickupDate">Pickup Date</label>
                                    <input type="date" class="form-control" id="pickupDate">
                                </div>
                                <div class="time-picker">
                                    <label for="pickupTime">Pickup Time</label>
                                    <select class="form-control" id="pickupTime">
                                        <option value="">Please select a time</option>
                                        <option value="09:00-11:00">09:00-11:00</option>
                                        <option value="11:00-13:00">11:00-13:00</option>
                                        <option value="13:00-15:00">13:00-15:00</option>
                                        <option value="15:00-17:00">15:00-17:00</option>
                                        <option value="17:00-19:00">17:00-19:00</option>
                                    </select>
                                </div>
                            </div>
                            <div class="address-form">
                                <div class="form-group full-width">
                                    <label for="pickupAddress">Pickup Address</label>
                                    <input type="text" class="form-control" id="pickupAddress" placeholder="Please enter detailed address">
                                </div>
                                <div class="form-group">
                                    <label for="pickupContact">Contact Person</label>
                                    <input type="text" class="form-control" id="pickupContact" placeholder="Please enter contact name">
                                </div>
                                <div class="form-group">
                                    <label for="pickupPhone">Phone Number</label>
                                    <input type="tel" class="form-control" id="pickupPhone" placeholder="Please enter phone number">
                                </div>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-secondary" id="backToStep1">Previous</button>
                                <button class="btn" id="nextToStep3" style="margin-left: 10px;">Next</button>
                            </div>
                        </div>

                        <!-- Step 3: Delivery Information -->
                        <div class="booking-form-content" id="step3Content">
                            <h3>Delivery Information</h3>
                            <div class="date-time-picker">
                                <div class="date-picker">
                                    <label for="deliveryDate">Delivery Date</label>
                                    <input type="date" class="form-control" id="deliveryDate">
                                </div>
                                <div class="time-picker">
                                    <label for="deliveryTime">Delivery Time</label>
                                    <select class="form-control" id="deliveryTime">
                                        <option value="">Please select a time</option>
                                        <option value="09:00-11:00">09:00-11:00</option>
                                        <option value="11:00-13:00">11:00-13:00</option>
                                        <option value="13:00-15:00">13:00-15:00</option>
                                        <option value="15:00-17:00">15:00-17:00</option>
                                        <option value="17:00-19:00">17:00-19:00</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="sameAsPickup"> Delivery address is same as pickup address
                                </label>
                            </div>
                            <div class="address-form" id="deliveryAddressForm">
                                <div class="form-group full-width">
                                    <label for="deliveryAddress">Delivery Address</label>
                                    <input type="text" class="form-control" id="deliveryAddress" placeholder="Please enter detailed address">
                                </div>
                                <div class="form-group">
                                    <label for="deliveryContact">Contact Person</label>
                                    <input type="text" class="form-control" id="deliveryContact" placeholder="Please enter contact name">
                                </div>
                                <div class="form-group">
                                    <label for="deliveryPhone">Phone Number</label>
                                    <input type="tel" class="form-control" id="deliveryPhone" placeholder="Please enter phone number">
                                </div>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-secondary" id="backToStep2">Previous</button>
                                <button class="btn" id="nextToStep4" style="margin-left: 10px;">Next</button>
                            </div>
                        </div>

                        <!-- Step 4: Order Confirmation -->
                        <div class="booking-form-content" id="step4Content">
                            <h3>Order Confirmation</h3>
                            <div class="order-summary">
                                <div class="summary-row">
                                    <span>Service Type:</span>
                                    <span id="confirmServiceType">-</span>
                                </div>
                                <div class="summary-row">
                                    <span>Number of Items:</span>
                                    <span id="confirmItemCount">-</span>
                                </div>
                                <div class="summary-row">
                                    <span>Pickup Time:</span>
                                    <span id="confirmPickupTime">-</span>
                                </div>
                                <div class="summary-row">
                                    <span>Pickup Address:</span>
                                    <span id="confirmPickupAddress">-</span>
                                </div>
                                <div class="summary-row">
                                    <span>Delivery Time:</span>
                                    <span id="confirmDeliveryTime">-</span>
                                </div>
                                <div class="summary-row">
                                    <span>Delivery Address:</span>
                                    <span id="confirmDeliveryAddress">-</span>
                                </div>
                                <div class="summary-row">
                                    <span>Special Instructions:</span>
                                    <span id="confirmSpecialInstructions">-</span>
                                </div>
                                <div class="summary-row total">
                                    <span>Estimated Cost:</span>
                                    <span id="confirmTotalPrice">-</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-secondary" id="backToStep3">Previous</button>
                                <button class="btn" id="submitBooking" style="margin-left: 10px;">Submit Order</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Dashboard Page -->
            <section id="dashboardPage" class="page hidden">
                <div class="container">
                    <h1 class="section-title">My Orders</h1>
                    <div class="dashboard-container">
                        <div class="dashboard-sidebar">
                            <div class="user-profile">
                                <div class="user-profile-avatar" id="dashboardUserAvatar">U</div>
                                <div class="user-profile-name" id="dashboardUserName">User</div>
                                <div class="user-profile-email" id="dashboardUserEmail">user@example.com</div>
                            </div>
                            <ul class="dashboard-menu">
                                <li><a href="#" class="dashboard-menu-item active" data-tab="orders"><i class="fas fa-list"></i> My Orders</a></li>
                                <li><a href="#" class="dashboard-menu-item" data-tab="profile"><i class="fas fa-user"></i> Profile</a></li>
                                <li><a href="#" class="dashboard-menu-item" data-tab="addresses"><i class="fas fa-map-marker-alt"></i> Addresses</a></li>
                                <li><a href="#" class="dashboard-menu-item" data-tab="settings"><i class="fas fa-cog"></i> Settings</a></li>
                            </ul>
                        </div>
                        <div class="dashboard-content">
                            <!-- Orders Tab -->
                            <div class="dashboard-tab active" id="ordersTab">
                                <h2>Order List</h2>
                                <div class="orders-list" id="ordersList">
                                    <!-- Orders will be dynamically added here -->
                                </div>
                            </div>
                            
                            <!-- Profile Tab -->
                            <div class="dashboard-tab" id="profileTab">
                                <h2>Profile Information</h2>
                                <form id="profileForm">
                                    <div class="form-group">
                                        <label for="profileName">Name</label>
                                        <input type="text" class="form-control" id="profileName">
                                    </div>
                                    <div class="form-group">
                                        <label for="profileEmail">Email</label>
                                        <input type="email" class="form-control" id="profileEmail">
                                    </div>
                                    <div class="form-group">
                                        <label for="profilePhone">Phone</label>
                                        <input type="tel" class="form-control" id="profilePhone">
                                    </div>
                                    <div class="form-group">
                                        <button type="submit" class="btn">Save Changes</button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- Addresses Tab -->
                            <div class="dashboard-tab" id="addressesTab">
                                <h2>Address Management</h2>
                                <div id="addressesList">
                                    <!-- Addresses will be dynamically added here -->
                                </div>
                                <button class="btn" id="addAddressBtn">Add New Address</button>
                            </div>
                            
                            <!-- Settings Tab -->
                            <div class="dashboard-tab" id="settingsTab">
                                <h2>Account Settings</h2>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="emailNotifications"> Receive email notifications
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="smsNotifications"> Receive SMS notifications
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="promoNotifications"> Receive promotional information
                                    </label>
                                </div>
                                <div class="form-group">
                                    <button class="btn" id="saveSettingsBtn">Save Settings</button>
                                </div>
                                <div class="form-group" style="margin-top: 30px;">
                                    <button class="btn" id="changePasswordBtn">Change Password</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Order Confirmation Page -->
            <section id="confirmationPage" class="page hidden">
                <div class="container">
                    <div class="confirmation-container">
                        <div class="confirmation-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h2 class="confirmation-title">Order Submitted Successfully!</h2>
                        <p class="confirmation-message">Your laundry service order has been successfully submitted. We will process it as soon as possible.</p>
                        <div class="order-details">
                            <div class="detail-row">
                                <span class="detail-label">Order Number:</span>
                                <span id="confirmationOrderId">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Service Type:</span>
                                <span id="confirmationServiceType">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Number of Items:</span>
                                <span id="confirmationItemCount">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Pickup Time:</span>
                                <span id="confirmationPickupTime">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Delivery Time:</span>
                                <span id="confirmationDeliveryTime">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Estimated Cost:</span>
                                <span id="confirmationTotalPrice">-</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <button class="btn" id="viewOrderBtn">View Order Details</button>
                            <button class="btn" id="backToHomeBtn" style="margin-left: 10px;">Back to Home</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer>
            <div class="container">
                <div class="footer-content">
                    <div class="footer-section">
                        <h3>About V-Wash Laundry</h3>
                        <p>We provide professional laundry services with convenient pickup and delivery options. Our team is dedicated to making your life easier with quality cleaning services.</p>
                        <div class="social-icons">
                            <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                            <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                            <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                            <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
                        </div>
                    </div>
                    <div class="footer-section">
                        <h3>Quick Links</h3>
                        <ul>
                            <li><a href="#" class="nav-link" data-page="home">Home</a></li>
                            <li><a href="#" class="nav-link" data-page="services">Services</a></li>
                            <li><a href="#" class="nav-link" data-page="booking">Book Service</a></li>
                            <li><a href="#" class="nav-link" data-page="dashboard">My Orders</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h3>Contact Us</h3>
                        <p><i class="fas fa-map-marker-alt"></i> Mazeras</p>
                        <p><i class="fas fa-phone"></i> +254 769831994</p>
                        <p><i class="fas fa-envelope"></i> info@vwashlaundry.co.ke</p>
                    </div>
                    <div class="footer-section">
                        <h3>Business Hours</h3>
                        <p>Monday - Friday: 8:00 AM - 8:00 PM</p>
                        <p>Saturday: 9:00 AM - 6:00 PM</p>
                        <p>Sunday: 10:00 AM - 4:00 PM</p>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2025 V-Wash Laundry. All rights reserved. | Developed by Peter J</p>
                </div>
            </div>
        </footer>

        <!-- Login/Register Modal -->
        <div class="modal" id="authModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="authModalTitle">Login</h3>
                    <button class="modal-close" id="closeAuthModal">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- Login Form -->
                    <form id="loginForm" class="auth-form">
                        <div class="form-group">
                            <label for="loginEmail">Email</label>
                            <input type="email" class="form-control" id="loginEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-block">Login</button>
                        </div>
                        <div class="auth-switch">
                            Don't have an account? <a href="#" id="showRegisterForm">Register Now</a>
                        </div>
                    </form>

                    <!-- Register Form -->
                    <form id="registerForm" class="auth-form hidden">
                        <div class="form-group">
                            <label for="registerName">Name</label>
                            <input type="text" class="form-control" id="registerName" required>
                        </div>
                        <div class="form-group">
                            <label for="registerEmail">Email</label>
                            <input type="email" class="form-control" id="registerEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="registerPhone">Phone</label>
                            <input type="tel" class="form-control" id="registerPhone" required>
                        </div>
                        <div class="form-group">
                            <label for="registerPassword">Password</label>
                            <input type="password" class="form-control" id="registerPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Confirm Password</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-block">Register</button>
                        </div>
                        <div class="auth-switch">
                            Already have an account? <a href="#" id="showLoginForm">Login Now</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Add Address Modal -->
        <div class="modal" id="addressModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Add Address</h3>
                    <button class="modal-close" id="closeAddressModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="addressForm">
                        <div class="form-group">
                            <label for="addressName">Address Name</label>
                            <input type="text" class="form-control" id="addressName" placeholder="e.g., Home, Office">
                        </div>
                        <div class="form-group">
                            <label for="addressDetail">Detailed Address</label>
                            <input type="text" class="form-control" id="addressDetail" placeholder="Please enter detailed address">
                        </div>
                        <div class="form-group">
                            <label for="addressContact">Contact Person</label>
                            <input type="text" class="form-control" id="addressContact" placeholder="Please enter contact name">
                        </div>
                        <div class="form-group">
                            <label for="addressPhone">Phone Number</label>
                            <input type="tel" class="form-control" id="addressPhone" placeholder="Please enter phone number">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="addressDefault"> Set as default address
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelAddressBtn">Cancel</button>
                    <button class="btn" id="saveAddressBtn">Save</button>
                </div>
            </div>
        </div>

        <!-- User Order Details Modal -->
        <div class="modal" id="userOrderDetailsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Order Details</h3>
                    <button class="modal-close" id="closeUserOrderDetailsModal">&times;</button>
                </div>
                <div class="modal-body" id="userOrderDetailsContent">
                    <!-- Order details will be added here -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="closeUserOrderDetailsBtn">Close</button>
                </div>
            </div>
        </div>

        <!-- Change Password Modal -->
        <div class="modal" id="changePasswordModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Change Password</h3>
                    <button class="modal-close" id="closeChangePasswordModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <div class="form-group">
                            <label for="currentPassword">Current Password</label>
                            <input type="password" class="form-control" id="currentPassword" placeholder="Enter current password" required>
                        </div>
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <input type="password" class="form-control" id="newPassword" placeholder="Enter new password" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmNewPassword">Confirm New Password</label>
                            <input type="password" class="form-control" id="confirmNewPassword" placeholder="Confirm new password" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelChangePasswordBtn">Cancel</button>
                    <button class="btn" id="savePasswordBtn">Change Password</button>
                </div>
            </div>
        </div>

        <!-- Notification -->
        <div class="notification" id="notification">
            <div class="notification-icon">
                <i class="fas fa-info-circle"></i>
            </div>
            <div class="notification-content">
                <div class="notification-title">Notification Title</div>
                <div class="notification-message">Notification Content</div>
            </div>
            <button class="notification-close" id="closeNotification">&times;</button>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden">
        <!-- Admin Header -->
        <header class="admin-header">
            <div class="container admin-header-container">
                <div class="admin-logo">
                    <img src="logo.png" class="admin-logo-img">
                    <span>V-Wash Laundry Admin</span>
                </div>
                <div class="admin-nav">
                    <a href="#" id="adminLogoutBtn">Logout</a>
                </div>
            </div>
        </header>

        <!-- Admin Container -->
        <div class="admin-container">
            <!-- Admin Sidebar -->
            <aside class="admin-sidebar">
                <ul class="admin-menu">
                    <li><a href="#" class="admin-menu-item active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="#" class="admin-menu-item" data-section="users"><i class="fas fa-users"></i> Users</a></li>
                    <li><a href="#" class="admin-menu-item" data-section="orders"><i class="fas fa-shopping-cart"></i> Orders</a></li>
                    <!-- Temporarily disabled - will be implemented in Phase 2 -->
                    <!-- <li><a href="#" class="admin-menu-item" data-section="services"><i class="fas fa-concierge-bell"></i> Services</a></li> -->
                    <!-- <li><a href="#" class="admin-menu-item" data-section="admins"><i class="fas fa-user-shield"></i> Admin Management</a></li> -->
                    <!-- <li><a href="#" class="admin-menu-item" data-section="database"><i class="fas fa-database"></i> Database</a></li> -->
                    <!-- <li><a href="#" class="admin-menu-item" data-section="settings"><i class="fas fa-cog"></i> Settings</a></li> -->
                </ul>
            </aside>

            <!-- Admin Content -->
            <main class="admin-content">
                <!-- Dashboard Section -->
                <section id="adminDashboardSection" class="admin-section">
                    <h1 class="admin-section-title">Dashboard</h1>
                    
                    <div class="db-status">
                        <div class="db-status-text">
                            <div class="db-status-icon">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="db-status-info">
                                <h3>Database Status</h3>
                                <p id="dbStatusText">Connected to IndexedDB</p>
                            </div>
                        </div>
                        <div class="db-actions">
                            <button class="btn" id="exportDbBtn">Export Data</button>
                            <button class="btn btn-secondary" id="importDbBtn">Import Data</button>
                        </div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon users">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="totalUsersCount">0</h3>
                                <p>Total Users</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon orders">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="totalOrdersCount">0</h3>
                                <p>Total Orders</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon revenue">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="totalRevenueCount">KSH 0</h3>
                                <p>Total Revenue</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon pending">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="pendingOrdersCount">0</h3>
                                <p>Pending Orders</p>
                            </div>
                        </div>
                    </div>

                    <div class="data-table">
                        <h2 style="padding: 20px;">Recent Orders</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th>Service</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Amount</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentOrdersTable">
                                <!-- Recent orders will be added here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Users Section -->
                <section id="adminUsersSection" class="admin-section hidden">
                    <h1 class="admin-section-title">Users Management</h1>
                    
                    <div class="data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Registration Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable">
                                <!-- Users will be added here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Orders Section -->
                <section id="adminOrdersSection" class="admin-section hidden">
                    <h1 class="admin-section-title">Orders Management</h1>
                    
                    <div class="data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th>Service</th>
                                    <th>Pickup Date</th>
                                    <th>Delivery Date</th>
                                    <th>Status</th>
                                    <th>Amount</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTable">
                                <!-- Orders will be added here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Services Section -->
                <section id="adminServicesSection" class="admin-section hidden">
                    <h1 class="admin-section-title">Services Management</h1>
                    
                    <div style="margin-bottom: 20px;">
                        <button class="btn" id="addServiceBtn">Add New Service</button>
                    </div>
                    
                    <div class="data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Description</th>
                                    <th>Price</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="servicesTable">
                                <!-- Services will be added here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Admin Management Section -->
                <section id="adminAdminsSection" class="admin-section hidden">
                    <h1 class="admin-section-title">Admin Management</h1>
                    
                    <div style="margin-bottom: 20px;">
                        <button class="btn" id="addAdminBtn">Add New Admin</button>
                    </div>
                    
                    <div class="data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Created Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminsTable">
                                <!-- Admins will be added here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Database Section -->
                <section id="adminDatabaseSection" class="admin-section hidden">
                    <h1 class="admin-section-title">Database Management</h1>
                    
                    <div class="data-table">
                        <div style="padding: 20px;">
                            <h3>Database Information</h3>
                            <div class="form-group">
                                <label>Database Type:</label>
                                <p>IndexedDB (Browser-based)</p>
                            </div>
                            <div class="form-group">
                                <label>Database Name:</label>
                                <p>freshlaundry_db</p>
                            </div>
                            <div class="form-group">
                                <label>Storage Location:</label>
                                <p>Browser local storage (persistent across sessions)</p>
                            </div>
                            <div class="form-group">
                                <label>Data Size:</label>
                                <p id="dbSize">Calculating...</p>
                            </div>
                            
                            <h3 style="margin-top: 30px;">Data Management</h3>
                            <div class="form-group">
                                <button class="btn" id="exportDbBtn2">Export All Data</button>
                                <button class="btn btn-secondary" id="importDbBtn2">Import Data</button>
                                <button class="btn btn-danger" id="clearDbBtn" style="margin-left: 10px;">Clear All Data</button>
                            </div>
                            
                            <h3 style="margin-top: 30px;">Backup & Restore</h3>
                            <div class="form-group">
                                <button class="btn" id="createBackupBtn">Create Backup</button>
                                <button class="btn btn-secondary" id="restoreBackupBtn">Restore from Backup</button>
                            </div>
                            
                            <h3 style="margin-top: 30px;">Database Statistics</h3>
                            <div id="dbStats">
                                <!-- Stats will be added here -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Settings Section -->
                <section id="adminSettingsSection" class="admin-section hidden">
                    <h1 class="admin-section-title">Settings</h1>
                    
                    <div class="data-table">
                        <div style="padding: 20px;">
                            <h3>General Settings</h3>
                            <div class="form-group">
                                <label for="companyName">Company Name</label>
                                <input type="text" class="form-control" id="companyName" value="V-Wash Laundry">
                            </div>
                            <div class="form-group">
                                <label for="companyEmail">Company Email</label>
                                <input type="email" class="form-control" id="companyEmail" value="info@vwashlaundry.co.ke">
                            </div>
                            <div class="form-group">
                                <label for="companyPhone">Company Phone</label>
                                <input type="tel" class="form-control" id="companyPhone" value="+254 712 345 678">
                            </div>
                            <div class="form-group">
                                <button class="btn" id="saveCompanySettingsBtn">Save Settings</button>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Order Details Modal -->
        <div class="modal" id="orderDetailsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Order Details</h3>
                    <button class="modal-close" id="closeOrderDetailsModal">&times;</button>
                </div>
                <div class="modal-body" id="orderDetailsContent">
                    <!-- Order details will be added here -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="closeOrderDetailsBtn">Close</button>
                </div>
            </div>
        </div>

        <!-- User Details Modal -->
        <div class="modal" id="userDetailsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">User Details</h3>
                    <button class="modal-close" id="closeUserDetailsModal">&times;</button>
                </div>
                <div class="modal-body" id="userDetailsContent">
                    <!-- User details will be added here -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="closeUserDetailsBtn">Close</button>
                </div>
            </div>
        </div>

        <!-- Update Order Status Modal -->
        <div class="modal" id="updateOrderStatusModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Update Order Status</h3>
                    <button class="modal-close" id="closeUpdateOrderStatusModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="updateOrderStatus">Order Status</label>
                        <select class="form-control" id="updateOrderStatusSelect">
                            <option value="order_placed">Order Placed</option>
                            <option value="pickup_scheduled">Pickup Scheduled</option>
                            <option value="picked_up">Picked Up</option>
                            <option value="processing">Processing</option>
                            <option value="completed">Completed</option>
                            <option value="delivery_scheduled">Delivery Scheduled</option>
                            <option value="delivered">Delivered</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="updateOrderNotes">Notes</label>
                        <textarea class="form-control" id="updateOrderNotes" rows="3" placeholder="Add any notes about this status update"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelUpdateOrderStatusBtn">Cancel</button>
                    <button class="btn" id="saveUpdateOrderStatusBtn">Update Status</button>
                </div>
            </div>
        </div>

        <!-- Add Service Modal -->
        <div class="modal" id="addServiceModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Add New Service</h3>
                    <button class="modal-close" id="closeAddServiceModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="addServiceForm">
                        <div class="form-group">
                            <label for="serviceName">Service Name</label>
                            <input type="text" class="form-control" id="serviceName" required>
                        </div>
                        <div class="form-group">
                            <label for="serviceDescription">Description</label>
                            <textarea class="form-control" id="serviceDescription" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="servicePrice">Price (KSH)</label>
                            <input type="number" class="form-control" id="servicePrice" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="serviceImageFile">Service Image</label>
                            <input type="file" class="form-control" id="serviceImageFile" accept="image/*">
                            <small class="form-text text-muted">Upload an image (max 5MB)</small>
                            <div id="imagePreview" style="margin-top: 10px; display: none;">
                                <img id="previewImg" src="" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 8px;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="serviceImage">Or Enter Image URL</label>
                            <input type="text" class="form-control" id="serviceImage" placeholder="Enter image URL (optional)">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelAddServiceBtn">Cancel</button>
                    <button class="btn" id="saveServiceBtn">Save</button>
                </div>
            </div>
        </div>

        <!-- Edit Service Modal -->
        <div class="modal" id="editServiceModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Edit Service</h3>
                    <button class="modal-close" id="closeEditServiceModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="editServiceForm">
                        <input type="hidden" id="editServiceId">
                        <div class="form-group">
                            <label for="editServiceName">Service Name</label>
                            <input type="text" class="form-control" id="editServiceName" required>
                        </div>
                        <div class="form-group">
                            <label for="editServiceDescription">Description</label>
                            <textarea class="form-control" id="editServiceDescription" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="editServicePrice">Price (KSH)</label>
                            <input type="number" class="form-control" id="editServicePrice" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="editServiceImageFile">Service Image</label>
                            <input type="file" class="form-control" id="editServiceImageFile" accept="image/*">
                            <small class="form-text text-muted">Upload new image (max 5MB) or leave empty to keep current</small>
                            <div id="editImagePreview" style="margin-top: 10px; display: none;">
                                <img id="editPreviewImg" src="" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 8px;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="editServiceImage">Or Enter Image URL</label>
                            <input type="text" class="form-control" id="editServiceImage" placeholder="Enter image URL (optional)">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelEditServiceBtn">Cancel</button>
                    <button class="btn" id="updateServiceBtn">Update</button>
                </div>
            </div>
        </div>

        <!-- Edit User Modal -->
        <div class="modal" id="editUserModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Edit User</h3>
                    <button class="modal-close" id="closeEditUserModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="editUserForm">
                        <input type="hidden" id="editUserId">
                        <div class="form-group">
                            <label for="editUserName">Name</label>
                            <input type="text" class="form-control" id="editUserName" required>
                        </div>
                        <div class="form-group">
                            <label for="editUserEmail">Email</label>
                            <input type="email" class="form-control" id="editUserEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="editUserPhone">Phone</label>
                            <input type="tel" class="form-control" id="editUserPhone" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelEditUserBtn">Cancel</button>
                    <button class="btn" id="updateUserBtn">Update</button>
                </div>
            </div>
        </div>

        <!-- Add Admin Modal -->
        <div class="modal" id="addAdminModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Add New Admin</h3>
                    <button class="modal-close" id="closeAddAdminModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="addAdminForm">
                        <div class="form-group">
                            <label for="adminName">Name</label>
                            <input type="text" class="form-control" id="adminName" required>
                        </div>
                        <div class="form-group">
                            <label for="adminEmail">Email</label>
                            <input type="email" class="form-control" id="adminEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="adminPhone">Phone</label>
                            <input type="tel" class="form-control" id="adminPhone" required>
                        </div>
                        <div class="form-group">
                            <label for="adminPassword">Password</label>
                            <input type="password" class="form-control" id="adminPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="adminRole">Role</label>
                            <select class="form-control" id="adminRole" required>
                                <option value="">Select a role</option>
                                <option value="super_admin">Super Admin</option>
                                <option value="admin">Admin</option>
                                <option value="manager">Manager</option>
                                <option value="staff">Staff</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="adminPermissions">Permissions</label>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="permUsers" value="users"> Manage Users
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="permOrders" value="orders"> Manage Orders
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="permServices" value="services"> Manage Services
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="permAdmins" value="admins"> Manage Admins
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="permDatabase" value="database"> Manage Database
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="permSettings" value="settings"> Manage Settings
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelAddAdminBtn">Cancel</button>
                    <button class="btn" id="saveAdminBtn">Add Admin</button>
                </div>
            </div>
        </div>

        <!-- Edit Admin Modal -->
        <div class="modal" id="editAdminModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Edit Admin</h3>
                    <button class="modal-close" id="closeEditAdminModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="editAdminForm">
                        <div class="form-group">
                            <label for="editAdminName">Name</label>
                            <input type="text" class="form-control" id="editAdminName" required>
                        </div>
                        <div class="form-group">
                            <label for="editAdminEmail">Email</label>
                            <input type="email" class="form-control" id="editAdminEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="editAdminPhone">Phone</label>
                            <input type="tel" class="form-control" id="editAdminPhone" required>
                        </div>
                        <div class="form-group">
                            <label for="editAdminRole">Role</label>
                            <select class="form-control" id="editAdminRole" required>
                                <option value="">Select a role</option>
                                <option value="super_admin">Super Admin</option>
                                <option value="admin">Admin</option>
                                <option value="manager">Manager</option>
                                <option value="staff">Staff</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editAdminStatus">Status</label>
                            <select class="form-control" id="editAdminStatus" required>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editAdminPassword">New Password (leave blank to keep current)</label>
                            <input type="password" class="form-control" id="editAdminPassword">
                        </div>
                        <div class="form-group">
                            <label for="editAdminPermissions">Permissions</label>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="editPermUsers" value="users"> Manage Users
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="editPermOrders" value="orders"> Manage Orders
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="editPermServices" value="services"> Manage Services
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="editPermAdmins" value="admins"> Manage Admins
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="editPermDatabase" value="database"> Manage Database
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="editPermSettings" value="settings"> Manage Settings
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelEditAdminBtn">Cancel</button>
                    <button class="btn" id="updateAdminBtn">Update Admin</button>
                </div>
            </div>
        </div>

        <!-- Import/Export Modal -->
        <div class="modal" id="importExportModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="importExportTitle">Data Management</h3>
                    <button class="modal-close" id="closeImportExportModal">&times;</button>
                </div>
                <div class="modal-body" id="importExportContent">
                    <!-- Content will be added here -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelImportExportBtn">Cancel</button>
                    <button class="btn" id="confirmImportExportBtn">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // ALL DATABASE OPERATIONS NOW USE BACKEND API
        // IndexedDB completely removed
        // ============================================

        /* DatabaseManager class removed - using backend API instead */

        // App State
        const app = {
            user: null,
            admin: null,
            currentPage: 'home',
            currentBookingStep: 1,
            currentOrder: null,
            orders: [],
            addresses: [],
            users: [],
            services: [],
            admins: [],
            db: {
                // Stub methods to prevent errors in non-critical functions
                getAll: async () => { console.warn('IndexedDB disabled - using API instead'); return []; },
                add: async () => { console.warn('IndexedDB disabled - using API instead'); },
                update: async () => { console.warn('IndexedDB disabled - using API instead'); },
                delete: async () => { console.warn('IndexedDB disabled - using API instead'); },
                exportAllData: async () => { console.warn('Export disabled'); return {}; },
                importData: async () => { console.warn('Import disabled'); },
                clearAllData: async () => { console.warn('Clear disabled'); },
                getDatabaseSize: async () => 'N/A (Cloud DB)'
            }
        };

        // DOM Elements
        const elements = {
            // Main Site
            mainSite: document.getElementById('mainSite'),
            adminPanel: document.getElementById('adminPanel'),
                        console.error('Database error:', event.target.error);
                        reject(event.target.error);
                    };
                    
                    request.onsuccess = (event) => {
                        this.db = event.target.result;
                        console.log('Database initialized successfully');
                        resolve(this.db);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        // Create object stores if they don't exist
                        if (!db.objectStoreNames.contains('users')) {
                            const userStore = db.createObjectStore('users', { keyPath: 'id' });
                            userStore.createIndex('email', 'email', { unique: true });
                        }
                        
                        if (!db.objectStoreNames.contains('orders')) {
                            const orderStore = db.createObjectStore('orders', { keyPath: 'id' });
                            orderStore.createIndex('userId', 'userId');
                            orderStore.createIndex('status', 'status');
                        }
                        
                        if (!db.objectStoreNames.contains('addresses')) {
                            const addressStore = db.createObjectStore('addresses', { keyPath: 'id' });
                            addressStore.createIndex('userId', 'userId');
                        }
                        
                        if (!db.objectStoreNames.contains('services')) {
                            const serviceStore = db.createObjectStore('services', { keyPath: 'id' });
                        }
                        
                        if (!db.objectStoreNames.contains('settings')) {
                            const settingsStore = db.createObjectStore('settings', { keyPath: 'key' });
                        }
                        
                        // Create admins object store
                        if (!db.objectStoreNames.contains('admins')) {
                            const adminStore = db.createObjectStore('admins', { keyPath: 'id' });
                            adminStore.createIndex('email', 'email', { unique: true });
                        }
                    };
                });
            }

            // Generic add method
            async add(storeName, data) {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        reject(new Error('Database not initialized'));
                        return;
                    }
                    
                    if (!this.db.objectStoreNames.contains(storeName)) {
                        reject(new Error(`Object store '${storeName}' not found`));
                        return;
                    }
                    
                    const transaction = this.db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    const request = store.add(data);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            // Generic get method
            async get(storeName, id) {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        reject(new Error('Database not initialized'));
                        return;
                    }
                    
                    if (!this.db.objectStoreNames.contains(storeName)) {
                        reject(new Error(`Object store '${storeName}' not found`));
                        return;
                    }
                    
                    const transaction = this.db.transaction([storeName], 'readonly');
                    const store = transaction.objectStore(storeName);
                    const request = store.get(id);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            // Generic getAll method
            async getAll(storeName) {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        reject(new Error('Database not initialized'));
                        return;
                    }
                    
                    if (!this.db.objectStoreNames.contains(storeName)) {
                        reject(new Error(`Object store '${storeName}' not found`));
                        return;
                    }
                    
                    const transaction = this.db.transaction([storeName], 'readonly');
                    const store = transaction.objectStore(storeName);
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            // Generic update method
            async update(storeName, data) {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        reject(new Error('Database not initialized'));
                        return;
                    }
                    
                    if (!this.db.objectStoreNames.contains(storeName)) {
                        reject(new Error(`Object store '${storeName}' not found`));
                        return;
                    }
                    
                    const transaction = this.db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    const request = store.put(data);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            // Generic delete method
            async delete(storeName, id) {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        reject(new Error('Database not initialized'));
                        return;
                    }
                    
                    if (!this.db.objectStoreNames.contains(storeName)) {
                        reject(new Error(`Object store '${storeName}' not found`));
                        return;
                    }
                    
                    const transaction = this.db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    const request = store.delete(id);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            // Query by index
            async queryByIndex(storeName, indexName, value) {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        reject(new Error('Database not initialized'));
                        return;
                    }
                    
                    if (!this.db.objectStoreNames.contains(storeName)) {
                        reject(new Error(`Object store '${storeName}' not found`));
                        return;
                    }
                    
                    const transaction = this.db.transaction([storeName], 'readonly');
                    const store = transaction.objectStore(storeName);
                    const index = store.index(indexName);
                    const request = index.getAll(value);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            // Get database size
            async getDatabaseSize() {
                return new Promise((resolve, reject) => {
                    if ('storage' in navigator && 'estimate' in navigator.storage) {
                        navigator.storage.estimate().then(estimate => {
                            const sizeInBytes = estimate.usage;
                            const sizeInKB = (sizeInBytes / 1024).toFixed(2);
                            resolve(`${sizeInKB} KB`);
                        }).catch(error => reject(error));
                    } else {
                        resolve('Not supported');
                    }
                });
            }

            // Export all data
            async exportAllData() {
                try {
                    const users = await this.getAll('users');
                    const orders = await this.getAll('orders');
                    const addresses = await this.getAll('addresses');
                    const services = await this.getAll('services');
                    const settings = await this.getAll('settings');
                    const admins = await this.getAll('admins');
                    
                    return {
                        users,
                        orders,
                        addresses,
                        services,
                        settings,
                        admins,
                        exportDate: new Date().toISOString()
                    };
                } catch (error) {
                    console.error('Error exporting data:', error);
                    throw error;
                }
            }

            // Import data
            async importData(data) {
                try {
                    // Clear existing data
                    await this.clearAllData();
                    
                    // Import users
                    if (data.users && Array.isArray(data.users)) {
                        for (const user of data.users) {
                            await this.add('users', user);
                        }
                    }
                    
                    // Import orders
                    if (data.orders && Array.isArray(data.orders)) {
                        for (const order of data.orders) {
                            await this.add('orders', order);
                        }
                    }
                    
                    // Import addresses
                    if (data.addresses && Array.isArray(data.addresses)) {
                        for (const address of data.addresses) {
                            await this.add('addresses', address);
                        }
                    }
                    
                    // Import services
                    if (data.services && Array.isArray(data.services)) {
                        for (const service of data.services) {
                            await this.add('services', service);
                        }
                    }
                    
                    // Import settings
                    if (data.settings && Array.isArray(data.settings)) {
                        for (const setting of data.settings) {
                            await this.add('settings', setting);
                        }
                    }
                    
                    // Import admins
                    if (data.admins && Array.isArray(data.admins)) {
                        for (const admin of data.admins) {
                            await this.add('admins', admin);
                        }
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Error importing data:', error);
                    throw error;
                }
            }

            // Clear all data
            async clearAllData() {
                try {
                    const stores = ['users', 'orders', 'addresses', 'services', 'settings', 'admins'];
                    
                    for (const storeName of stores) {
                        await this.clearStore(storeName);
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Error clearing data:', error);
                    throw error;
                }
            }

            // Clear a specific store
            async clearStore(storeName) {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        reject(new Error('Database not initialized'));
                        return;
                    }
                    
                    if (!this.db.objectStoreNames.contains(storeName)) {
                        reject(new Error(`Object store '${storeName}' not found`));
                        return;
                    }
                    
                    const transaction = this.db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    const request = store.clear();
                    
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            }
        }
        END OF COMMENTED OUT DatabaseManager CLASS */

        // App State
        const app = {
            user: null,
            admin: null,
            currentPage: 'home',
            currentBookingStep: 1,
            currentOrder: null,
            orders: [],
            addresses: [],
            users: [],
            services: [],
            admins: [],
            db: {
                // Stub methods to prevent errors in non-critical functions
                getAll: async () => { console.warn('IndexedDB disabled - using API instead'); return []; },
                add: async () => { console.warn('IndexedDB disabled - using API instead'); },
                update: async () => { console.warn('IndexedDB disabled - using API instead'); },
                delete: async () => { console.warn('IndexedDB disabled - using API instead'); },
                exportAllData: async () => { console.warn('Export disabled'); return {}; },
                importData: async () => { console.warn('Import disabled'); },
                clearAllData: async () => { console.warn('Clear disabled'); },
                getDatabaseSize: async () => 'N/A (Cloud DB)'
            }
        };

        // DOM Elements
        const elements = {
            // Main Site
            mainSite: document.getElementById('mainSite'),
            adminPanel: document.getElementById('adminPanel'),
            
            // Pages
            pages: document.querySelectorAll('.page'),
            homePage: document.getElementById('homePage'),
            servicesPage: document.getElementById('servicesPage'),
            bookingPage: document.getElementById('bookingPage'),
            dashboardPage: document.getElementById('dashboardPage'),
            confirmationPage: document.getElementById('confirmationPage'),
            
            // Navigation
            navLinks: document.querySelectorAll('.nav-link'),
            loginBtn: document.getElementById('loginBtn'),
            logoutBtn: document.getElementById('logoutBtn'),
            userInfo: document.getElementById('userInfo'),
            loginPrompt: document.getElementById('loginPrompt'),
            userName: document.getElementById('userName'),
            userAvatar: document.getElementById('userAvatar'),
            
            // Auth Modal
            authModal: document.getElementById('authModal'),
            authModalTitle: document.getElementById('authModalTitle'),
            closeAuthModal: document.getElementById('closeAuthModal'),
            loginForm: document.getElementById('loginForm'),
            registerForm: document.getElementById('registerForm'),
            showRegisterForm: document.getElementById('showRegisterForm'),
            showLoginForm: document.getElementById('showLoginForm'),
            
            // Booking
            bookServiceBtns: document.querySelectorAll('.book-service-btn'),
            bookingSteps: document.querySelectorAll('.step'),
            bookingFormContents: document.querySelectorAll('.booking-form-content'),
            serviceType: document.getElementById('serviceType'),
            itemCount: document.getElementById('itemCount'),
            specialInstructions: document.getElementById('specialInstructions'),
            pickupDate: document.getElementById('pickupDate'),
            pickupTime: document.getElementById('pickupTime'),
            pickupAddress: document.getElementById('pickupAddress'),
            pickupContact: document.getElementById('pickupContact'),
            pickupPhone: document.getElementById('pickupPhone'),
            deliveryDate: document.getElementById('deliveryDate'),
            deliveryTime: document.getElementById('deliveryTime'),
            sameAsPickup: document.getElementById('sameAsPickup'),
            deliveryAddressForm: document.getElementById('deliveryAddressForm'),
            deliveryAddress: document.getElementById('deliveryAddress'),
            deliveryContact: document.getElementById('deliveryContact'),
            deliveryPhone: document.getElementById('deliveryPhone'),
            
            // Booking Navigation
            nextToStep2: document.getElementById('nextToStep2'),
            backToStep1: document.getElementById('backToStep1'),
            nextToStep3: document.getElementById('nextToStep3'),
            backToStep2: document.getElementById('backToStep2'),
            nextToStep4: document.getElementById('nextToStep4'),
            backToStep3: document.getElementById('backToStep3'),
            submitBooking: document.getElementById('submitBooking'),
            
            // Order Confirmation
            confirmServiceType: document.getElementById('confirmServiceType'),
            confirmItemCount: document.getElementById('confirmItemCount'),
            confirmPickupTime: document.getElementById('confirmPickupTime'),
            confirmPickupAddress: document.getElementById('confirmPickupAddress'),
            confirmDeliveryTime: document.getElementById('confirmDeliveryTime'),
            confirmDeliveryAddress: document.getElementById('confirmDeliveryAddress'),
            confirmSpecialInstructions: document.getElementById('confirmSpecialInstructions'),
            confirmTotalPrice: document.getElementById('confirmTotalPrice'),
            
            // Confirmation Page
            confirmationOrderId: document.getElementById('confirmationOrderId'),
            confirmationServiceType: document.getElementById('confirmationServiceType'),
            confirmationItemCount: document.getElementById('confirmationItemCount'),
            confirmationPickupTime: document.getElementById('confirmationPickupTime'),
            confirmationDeliveryTime: document.getElementById('confirmationDeliveryTime'),
            confirmationTotalPrice: document.getElementById('confirmationTotalPrice'),
            viewOrderBtn: document.getElementById('viewOrderBtn'),
            backToHomeBtn: document.getElementById('backToHomeBtn'),
            
            // Dashboard
            dashboardUserAvatar: document.getElementById('dashboardUserAvatar'),
            dashboardUserName: document.getElementById('dashboardUserName'),
            dashboardUserEmail: document.getElementById('dashboardUserEmail'),
            dashboardMenuItems: document.querySelectorAll('.dashboard-menu-item'),
            dashboardTabs: document.querySelectorAll('.dashboard-tab'),
            ordersList: document.getElementById('ordersList'),
            profileForm: document.getElementById('profileForm'),
            addressesList: document.getElementById('addressesList'),
            addAddressBtn: document.getElementById('addAddressBtn'),
            saveSettingsBtn: document.getElementById('saveSettingsBtn'),
            
            // Address Modal
            addressModal: document.getElementById('addressModal'),
            closeAddressModal: document.getElementById('closeAddressModal'),
            addressForm: document.getElementById('addressForm'),
            cancelAddressBtn: document.getElementById('cancelAddressBtn'),
            saveAddressBtn: document.getElementById('saveAddressBtn'),
            
            // User Order Details Modal
            userOrderDetailsModal: document.getElementById('userOrderDetailsModal'),
            userOrderDetailsContent: document.getElementById('userOrderDetailsContent'),
            closeUserOrderDetailsModal: document.getElementById('closeUserOrderDetailsModal'),
            closeUserOrderDetailsBtn: document.getElementById('closeUserOrderDetailsBtn'),
            
            // Change Password Modal
            changePasswordModal: document.getElementById('changePasswordModal'),
            closeChangePasswordModal: document.getElementById('closeChangePasswordModal'),
            changePasswordForm: document.getElementById('changePasswordForm'),
            cancelChangePasswordBtn: document.getElementById('cancelChangePasswordBtn'),
            savePasswordBtn: document.getElementById('savePasswordBtn'),
            changePasswordBtn: document.getElementById('changePasswordBtn'),
            
            // Admin Panel
            adminLogoutBtn: document.getElementById('adminLogoutBtn'),
            adminMenuItems: document.querySelectorAll('.admin-menu-item'),
            adminSections: document.querySelectorAll('.admin-section'),
            
            // Admin Dashboard
            totalUsersCount: document.getElementById('totalUsersCount'),
            totalOrdersCount: document.getElementById('totalOrdersCount'),
            totalRevenueCount: document.getElementById('totalRevenueCount'),
            pendingOrdersCount: document.getElementById('pendingOrdersCount'),
            recentOrdersTable: document.getElementById('recentOrdersTable'),
            
            // Admin Tables
            usersTable: document.getElementById('usersTable'),
            ordersTable: document.getElementById('ordersTable'),
            servicesTable: document.getElementById('servicesTable'),
            adminsTable: document.getElementById('adminsTable'),
            
            // Admin Database
            dbStatusText: document.getElementById('dbStatusText'),
            dbSize: document.getElementById('dbSize'),
            exportDbBtn: document.getElementById('exportDbBtn'),
            importDbBtn: document.getElementById('importDbBtn'),
            exportDbBtn2: document.getElementById('exportDbBtn2'),
            importDbBtn2: document.getElementById('importDbBtn2'),
            clearDbBtn: document.getElementById('clearDbBtn'),
            createBackupBtn: document.getElementById('createBackupBtn'),
            restoreBackupBtn: document.getElementById('restoreBackupBtn'),
            dbStats: document.getElementById('dbStats'),
            
            // Admin Settings
            saveCompanySettingsBtn: document.getElementById('saveCompanySettingsBtn'),
            
            // Admin Modals
            orderDetailsModal: document.getElementById('orderDetailsModal'),
            closeOrderDetailsModal: document.getElementById('closeOrderDetailsModal'),
            closeOrderDetailsBtn: document.getElementById('closeOrderDetailsBtn'),
            orderDetailsContent: document.getElementById('orderDetailsContent'),
            
            userDetailsModal: document.getElementById('userDetailsModal'),
            closeUserDetailsModal: document.getElementById('closeUserDetailsModal'),
            closeUserDetailsBtn: document.getElementById('closeUserDetailsBtn'),
            userDetailsContent: document.getElementById('userDetailsContent'),
            
            updateOrderStatusModal: document.getElementById('updateOrderStatusModal'),
            closeUpdateOrderStatusModal: document.getElementById('closeUpdateOrderStatusModal'),
            cancelUpdateOrderStatusBtn: document.getElementById('cancelUpdateOrderStatusBtn'),
            saveUpdateOrderStatusBtn: document.getElementById('saveUpdateOrderStatusBtn'),
            updateOrderStatusSelect: document.getElementById('updateOrderStatusSelect'),
            updateOrderNotes: document.getElementById('updateOrderNotes'),
            
            // Admin Management Modals
            addAdminModal: document.getElementById('addAdminModal'),
            closeAddAdminModal: document.getElementById('closeAddAdminModal'),
            addAdminForm: document.getElementById('addAdminForm'),
            cancelAddAdminBtn: document.getElementById('cancelAddAdminBtn'),
            saveAdminBtn: document.getElementById('saveAdminBtn'),
            
            editAdminModal: document.getElementById('editAdminModal'),
            closeEditAdminModal: document.getElementById('closeEditAdminModal'),
            editAdminForm: document.getElementById('editAdminForm'),
            cancelEditAdminBtn: document.getElementById('cancelEditAdminBtn'),
            updateAdminBtn: document.getElementById('updateAdminBtn'),
            
            // Service Management Modals
            addServiceModal: document.getElementById('addServiceModal'),
            closeAddServiceModal: document.getElementById('closeAddServiceModal'),
            addServiceForm: document.getElementById('addServiceForm'),
            cancelAddServiceBtn: document.getElementById('cancelAddServiceBtn'),
            saveServiceBtn: document.getElementById('saveServiceBtn'),
            
            editServiceModal: document.getElementById('editServiceModal'),
            closeEditServiceModal: document.getElementById('closeEditServiceModal'),
            editServiceForm: document.getElementById('editServiceForm'),
            cancelEditServiceBtn: document.getElementById('cancelEditServiceBtn'),
            updateServiceBtn: document.getElementById('updateServiceBtn'),
            
            // User Management Modals
            editUserModal: document.getElementById('editUserModal'),
            closeEditUserModal: document.getElementById('closeEditUserModal'),
            editUserForm: document.getElementById('editUserForm'),
            cancelEditUserBtn: document.getElementById('cancelEditUserBtn'),
            updateUserBtn: document.getElementById('updateUserBtn'),
            
            // Import/Export Modal
            importExportModal: document.getElementById('importExportModal'),
            closeImportExportModal: document.getElementById('closeImportExportModal'),
            importExportTitle: document.getElementById('importExportTitle'),
            importExportContent: document.getElementById('importExportContent'),
            cancelImportExportBtn: document.getElementById('cancelImportExportBtn'),
            confirmImportExportBtn: document.getElementById('confirmImportExportBtn'),
            
            // Notification
            notification: document.getElementById('notification'),
            closeNotification: document.getElementById('closeNotification')
        };

        // Initialize App
        async function init() {
            try {
                // Initialize API client
                app.api = new APIClient();
                
                // Check if user is logged in
                await checkAuthStatus();
                
                // Set up event listeners
                setupEventListeners();
                
                // Set minimum dates for pickup and delivery
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                elements.pickupDate.min = tomorrow.toISOString().split('T')[0];
                
                const dayAfterTomorrow = new Date(tomorrow);
                dayAfterTomorrow.setDate(dayAfterTomorrow.getDate() + 1);
                elements.deliveryDate.min = dayAfterTomorrow.toISOString().split('T')[0];
                
                // Update user services (loads hardcoded services)
                updateUserServices();
            } catch (error) {
                console.error('Error initializing app:', error);
                showNotification('Initialization Error', 'Failed to initialize the application', 'error');
            }
        }

        // Update database status
        async function updateDatabaseStatus() {
            try {
                // Get stats from API
                const statsResponse = await apiClient.get('/api/admin/stats');
                
                elements.dbSize.textContent = 'N/A (Cloud DB)';
                
                // Update database stats
                elements.dbStats.innerHTML = `
                    <div class="summary-row">
                        <span class="detail-label">Users:</span>
                        <span>${statsResponse.totalUsers || 0}</span>
                    </div>
                    <div class="summary-row">
                        <span class="detail-label">Orders:</span>
                        <span>${statsResponse.totalOrders || 0}</span>
                    </div>
                    <div class="summary-row">
                        <span class="detail-label">Addresses:</span>
                        <span>N/A</span>
                    </div>
                    <div class="summary-row">
                        <span class="detail-label">Services:</span>
                        <span>N/A</span>
                    </div>
                    <div class="summary-row">
                        <span class="detail-label">Admins:</span>
                        <span>N/A</span>
                    </div>
                `;
            } catch (error) {
                console.error('Error updating database status:', error);
                elements.dbSize.textContent = 'Error';
            }
        }

        // Check Authentication Status
        async function checkAuthStatus() {
            try {
                // Check if API client exists
                if (!app.api) {
                    app.api = new APIClient();
                }
                
                const savedUser = localStorage.getItem('laundryUser');
                if (savedUser) {
                    app.user = JSON.parse(savedUser);
                    updateUserUI();
                }
                
                const savedAdmin = localStorage.getItem('laundryAdmin');
                if (savedAdmin) {
                    app.admin = JSON.parse(savedAdmin);
                    showAdminPanel();
                }
            } catch (error) {
                console.error('Error checking auth status:', error);
            }
        }

        // Update User UI
        function updateUserUI() {
            if (app.user) {
                elements.userInfo.classList.remove('hidden');
                elements.loginPrompt.classList.add('hidden');
                elements.userName.textContent = app.user.name;
                elements.userAvatar.textContent = app.user.name.charAt(0).toUpperCase();
                elements.dashboardUserName.textContent = app.user.name;
                elements.dashboardUserEmail.textContent = app.user.email;
                elements.dashboardUserAvatar.textContent = app.user.name.charAt(0).toUpperCase();
                
                // Populate profile form
                document.getElementById('profileName').value = app.user.name;
                document.getElementById('profileEmail').value = app.user.email;
                document.getElementById('profilePhone').value = app.user.phone;
            } else {
                elements.userInfo.classList.add('hidden');
                elements.loginPrompt.classList.remove('hidden');
            }
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Navigation
            elements.navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    navigateToPage(page);
                });
            });
            
            // Footer navigation
            document.querySelectorAll('footer .nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    navigateToPage(page);
                });
            });
            
            // Auth
            elements.loginBtn.addEventListener('click', () => {
                showAuthModal('login');
            });
            
            elements.logoutBtn.addEventListener('click', () => {
                logout();
            });
            
            elements.closeAuthModal.addEventListener('click', () => {
                elements.authModal.classList.remove('show');
            });
            
            elements.showRegisterForm.addEventListener('click', (e) => {
                e.preventDefault();
                showAuthModal('register');
            });
            
            elements.showLoginForm.addEventListener('click', (e) => {
                e.preventDefault();
                showAuthModal('login');
            });
            
            elements.loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                login();
            });
            
            elements.registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                register();
            });
            
            // Booking
            // We'll handle book service buttons dynamically in updateUserServices
            
            // Booking Navigation
            elements.nextToStep2.addEventListener('click', () => {
                if (validateStep1()) {
                    goToBookingStep(2);
                }
            });
            
            elements.backToStep1.addEventListener('click', () => {
                goToBookingStep(1);
            });
            
            elements.nextToStep3.addEventListener('click', () => {
                if (validateStep2()) {
                    goToBookingStep(3);
                }
            });
            
            elements.backToStep2.addEventListener('click', () => {
                goToBookingStep(2);
            });
            
            elements.nextToStep4.addEventListener('click', () => {
                if (validateStep3()) {
                    goToBookingStep(4);
                    updateOrderSummary();
                }
            });
            
            elements.backToStep3.addEventListener('click', () => {
                goToBookingStep(3);
            });
            
            elements.submitBooking.addEventListener('click', () => {
                submitBooking();
            });
            
            // Same as pickup checkbox
            elements.sameAsPickup.addEventListener('change', () => {
                if (elements.sameAsPickup.checked) {
                    elements.deliveryAddressForm.style.display = 'none';
                    elements.deliveryAddress.value = elements.pickupAddress.value;
                    elements.deliveryContact.value = elements.pickupContact.value;
                    elements.deliveryPhone.value = elements.pickupPhone.value;
                } else {
                    elements.deliveryAddressForm.style.display = 'grid';
                }
            });
            
            // Update delivery date when pickup date changes
            elements.pickupDate.addEventListener('change', () => {
                const pickupDate = new Date(elements.pickupDate.value);
                const minDeliveryDate = new Date(pickupDate);
                minDeliveryDate.setDate(minDeliveryDate.getDate() + 1);
                elements.deliveryDate.min = minDeliveryDate.toISOString().split('T')[0];
                
                if (elements.deliveryDate.value && new Date(elements.deliveryDate.value) <= pickupDate) {
                    elements.deliveryDate.value = minDeliveryDate.toISOString().split('T')[0];
                }
            });
            
            // Confirmation Page
            elements.viewOrderBtn.addEventListener('click', () => {
                showUserOrderDetails(app.currentOrder);
            });
            
            elements.backToHomeBtn.addEventListener('click', () => {
                navigateToPage('home');
            });
            
            // Dashboard
            elements.dashboardMenuItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tab = item.getAttribute('data-tab');
                    switchDashboardTab(tab);
                });
            });
            
            elements.profileForm.addEventListener('submit', (e) => {
                e.preventDefault();
                updateProfile();
            });
            
            // Change Password Button
            if (elements.changePasswordBtn) {
                elements.changePasswordBtn.addEventListener('click', () => {
                    elements.changePasswordModal.classList.add('show');
                });
            }
            
            // Change Password Modal
            elements.closeChangePasswordModal.addEventListener('click', () => {
                elements.changePasswordModal.classList.remove('show');
                elements.changePasswordForm.reset();
            });
            
            elements.cancelChangePasswordBtn.addEventListener('click', () => {
                elements.changePasswordModal.classList.remove('show');
                elements.changePasswordForm.reset();
            });
            
            elements.savePasswordBtn.addEventListener('click', () => {
                changePassword();
            });
            
            elements.changePasswordForm.addEventListener('submit', (e) => {
                e.preventDefault();
                changePassword();
            });
            
            elements.addAddressBtn.addEventListener('click', () => {
                elements.addressModal.classList.add('show');
            });
            
            elements.saveSettingsBtn.addEventListener('click', () => {
                saveSettings();
            });
            
            // Address Modal
            elements.closeAddressModal.addEventListener('click', () => {
                elements.addressModal.classList.remove('show');
            });
            
            elements.cancelAddressBtn.addEventListener('click', () => {
                elements.addressModal.classList.remove('show');
            });
            
            elements.saveAddressBtn.addEventListener('click', () => {
                saveAddress();
            });
            
            // User Order Details Modal
            elements.closeUserOrderDetailsModal.addEventListener('click', () => {
                elements.userOrderDetailsModal.classList.remove('show');
            });
            
            elements.closeUserOrderDetailsBtn.addEventListener('click', () => {
                elements.userOrderDetailsModal.classList.remove('show');
            });
            
            // Admin Panel
            elements.adminLogoutBtn.addEventListener('click', () => {
                adminLogout();
            });
            
            elements.adminMenuItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = item.getAttribute('data-section');
                    switchAdminSection(section);
                });
            });
            
            // Database Management
            elements.exportDbBtn.addEventListener('click', () => {
                exportDatabase();
            });
            
            elements.importDbBtn.addEventListener('click', () => {
                showImportModal();
            });
            
            elements.exportDbBtn2.addEventListener('click', () => {
                exportDatabase();
            });
            
            elements.importDbBtn2.addEventListener('click', () => {
                showImportModal();
            });
            
            elements.clearDbBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                    clearDatabase();
                }
            });
            
            elements.createBackupBtn.addEventListener('click', () => {
                createBackup();
            });
            
            elements.restoreBackupBtn.addEventListener('click', () => {
                showRestoreModal();
            });
            
            // Admin Settings
            elements.saveCompanySettingsBtn.addEventListener('click', () => {
                saveCompanySettings();
            });
            
            // Admin Management
            document.getElementById('addAdminBtn').addEventListener('click', () => {
                elements.addAdminModal.classList.add('show');
            });
            
            elements.closeAddAdminModal.addEventListener('click', () => {
                elements.addAdminModal.classList.remove('show');
            });
            
            elements.cancelAddAdminBtn.addEventListener('click', () => {
                elements.addAdminModal.classList.remove('show');
            });
            
            elements.saveAdminBtn.addEventListener('click', () => {
                addAdmin();
            });
            
            elements.closeEditAdminModal.addEventListener('click', () => {
                elements.editAdminModal.classList.remove('show');
            });
            
            elements.cancelEditAdminBtn.addEventListener('click', () => {
                elements.editAdminModal.classList.remove('show');
            });
            
            elements.updateAdminBtn.addEventListener('click', () => {
                updateAdmin();
            });
            
            // Service Management
            document.getElementById('addServiceBtn').addEventListener('click', () => {
                showAddServiceModal();
            });
            
            elements.closeAddServiceModal.addEventListener('click', () => {
                elements.addServiceModal.classList.remove('show');
            });
            
            elements.cancelAddServiceBtn.addEventListener('click', () => {
                elements.addServiceModal.classList.remove('show');
            });
            
            elements.saveServiceBtn.addEventListener('click', () => {
                addService();
            });
            
            elements.closeEditServiceModal.addEventListener('click', () => {
                elements.editServiceModal.classList.remove('show');
            });
            
            elements.cancelEditServiceBtn.addEventListener('click', () => {
                elements.editServiceModal.classList.remove('show');
            });
            
            elements.updateServiceBtn.addEventListener('click', () => {
                updateService();
            });
            
            // Image Preview for Add Service
            const serviceImageFile = document.getElementById('serviceImageFile');
            if (serviceImageFile) {
                serviceImageFile.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            document.getElementById('previewImg').src = e.target.result;
                            document.getElementById('imagePreview').style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            // Image Preview for Edit Service
            const editServiceImageFile = document.getElementById('editServiceImageFile');
            if (editServiceImageFile) {
                editServiceImageFile.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            document.getElementById('editPreviewImg').src = e.target.result;
                            document.getElementById('editImagePreview').style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            // User Management
            elements.closeEditUserModal.addEventListener('click', () => {
                elements.editUserModal.classList.remove('show');
            });
            
            elements.cancelEditUserBtn.addEventListener('click', () => {
                elements.editUserModal.classList.remove('show');
            });
            
            elements.updateUserBtn.addEventListener('click', () => {
                updateUser();
            });
            
            // Admin Modals
            elements.closeOrderDetailsModal.addEventListener('click', () => {
                elements.orderDetailsModal.classList.remove('show');
            });
            
            elements.closeOrderDetailsBtn.addEventListener('click', () => {
                elements.orderDetailsModal.classList.remove('show');
            });
            
            elements.closeUserDetailsModal.addEventListener('click', () => {
                elements.userDetailsModal.classList.remove('show');
            });
            
            elements.closeUserDetailsBtn.addEventListener('click', () => {
                elements.userDetailsModal.classList.remove('show');
            });
            
            elements.closeUpdateOrderStatusModal.addEventListener('click', () => {
                elements.updateOrderStatusModal.classList.remove('show');
            });
            
            elements.cancelUpdateOrderStatusBtn.addEventListener('click', () => {
                elements.updateOrderStatusModal.classList.remove('show');
            });
            
            elements.saveUpdateOrderStatusBtn.addEventListener('click', () => {
                updateOrderStatus();
            });
            
            // Import/Export Modal
            elements.closeImportExportModal.addEventListener('click', () => {
                elements.importExportModal.classList.remove('show');
            });
            
            elements.cancelImportExportBtn.addEventListener('click', () => {
                elements.importExportModal.classList.remove('show');
            });
            
            // Notification
            elements.closeNotification.addEventListener('click', () => {
                elements.notification.classList.remove('show');
            });
        }

        // Navigation
        function navigateToPage(page) {
            // Hide all pages
            elements.pages.forEach(p => p.classList.add('hidden'));
            
            // Show selected page
            switch(page) {
                case 'home':
                    elements.homePage.classList.remove('hidden');
                    break;
                case 'services':
                    elements.servicesPage.classList.remove('hidden');
                    break;
                case 'booking':
                    elements.bookingPage.classList.remove('hidden');
                    break;
                case 'dashboard':
                    elements.dashboardPage.classList.remove('hidden');
                    loadOrders();
                    break;
                case 'confirmation':
                    elements.confirmationPage.classList.remove('hidden');
                    break;
            }
            
            // Update active nav link
            elements.navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === page) {
                    link.classList.add('active');
                }
            });
            
            app.currentPage = page;
        }

        // Auth Functions
        function showAuthModal(type) {
            if (type === 'login') {
                elements.authModalTitle.textContent = 'Login';
                elements.loginForm.classList.remove('hidden');
                elements.registerForm.classList.add('hidden');
            } else {
                elements.authModalTitle.textContent = 'Register';
                elements.loginForm.classList.add('hidden');
                elements.registerForm.classList.remove('hidden');
            }
            elements.authModal.classList.add('show');
        }

        async function login() {
            try {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                // Check if admin login attempt
                if (email.includes('admin') || email === 'admin@vwashlaundry.co.ke') {
                    try {
                        const response = await app.api.loginAdmin({ email, password });
                        app.admin = response.admin;
                        localStorage.setItem('laundryAdmin', JSON.stringify(response.admin));
                        showAdminPanel();
                        elements.authModal.classList.remove('show');
                        showNotification('Admin Login Successful', `Welcome, ${response.admin.name}!`, 'success');
                        elements.loginForm.reset();
                        return;
                    } catch (error) {
                        showNotification('Login Failed', 'Incorrect admin credentials', 'error');
                        return;
                    }
                }
                
                // Regular user login
                try {
                    const response = await app.api.loginUser({ email, password });
                    app.user = response.user;
                    localStorage.setItem('laundryUser', JSON.stringify(response.user));
                    updateUserUI();
                    elements.authModal.classList.remove('show');
                    showNotification('Login Successful', `Welcome back, ${response.user.name}!`, 'success');
                    elements.loginForm.reset();
                } catch (error) {
                    showNotification('Login Failed', error.message || 'Incorrect email or password', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showNotification('Login Error', 'An error occurred during login', 'error');
            }
        }

        async function register() {
            try {
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const phone = document.getElementById('registerPhone').value;
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                // Validate passwords match
                if (password !== confirmPassword) {
                    showNotification('Registration Failed', 'Passwords do not match', 'error');
                    return;
                }
                
                // Register via API
                const response = await app.api.registerUser({
                    name,
                    email,
                    phone,
                    password
                });
                
                // Save user data
                app.user = response.user;
                localStorage.setItem('laundryUser', JSON.stringify(response.user));
                
                updateUserUI();
                elements.authModal.classList.remove('show');
                showNotification('Registration Successful', `Welcome, ${name}!`, 'success');
                
                // Reset form
                elements.registerForm.reset();
            } catch (error) {
                console.error('Registration error:', error);
                showNotification('Registration Error', error.message || 'An error occurred during registration', 'error');
            }
        }

        function logout() {
            app.user = null;
            app.api.logout();
            localStorage.removeItem('laundryUser');
            updateUserUI();
            navigateToPage('home');
            showNotification('Logged Out', 'You have been successfully logged out', 'info');
        }

        function adminLogout() {
            app.admin = null;
            app.api.logout();
            localStorage.removeItem('laundryAdmin');
            showMainSite();
            showNotification('Logged Out', 'You have been successfully logged out of admin panel', 'info');
        }

        function showMainSite() {
            elements.mainSite.classList.remove('hidden');
            elements.adminPanel.classList.add('hidden');
        }

        function showAdminPanel() {
            elements.mainSite.classList.add('hidden');
            elements.adminPanel.classList.remove('hidden');
            loadAdminDashboard();
        }

        // Admin Functions
        function switchAdminSection(section) {
            // Update menu items
            elements.adminMenuItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-section') === section) {
                    item.classList.add('active');
                }
            });
            
            // Update sections
            elements.adminSections.forEach(s => {
                s.classList.add('hidden');
            });
            
            // Show selected section
            switch(section) {
                case 'dashboard':
                    document.getElementById('adminDashboardSection').classList.remove('hidden');
                    loadAdminDashboard();
                    break;
                case 'users':
                    document.getElementById('adminUsersSection').classList.remove('hidden');
                    loadUsersTable();
                    break;
                case 'orders':
                    document.getElementById('adminOrdersSection').classList.remove('hidden');
                    loadOrdersTable();
                    break;
                case 'services':
                    document.getElementById('adminServicesSection').classList.remove('hidden');
                    loadServicesTable();
                    break;
                case 'admins':
                    document.getElementById('adminAdminsSection').classList.remove('hidden');
                    loadAdminsTable();
                    break;
                case 'database':
                    document.getElementById('adminDatabaseSection').classList.remove('hidden');
                    updateDatabaseStatus();
                    break;
                case 'settings':
                    document.getElementById('adminSettingsSection').classList.remove('hidden');
                    break;
            }
        }

        async function loadAdminDashboard() {
            try {
                // Get stats from API
                const stats = await app.api.getAdminStats();
                
                // Update stats
                elements.totalUsersCount.textContent = stats.totalUsers;
                elements.totalOrdersCount.textContent = stats.totalOrders;
                elements.totalRevenueCount.textContent = `KSH ${stats.totalRevenue.toFixed(2)}`;
                elements.pendingOrdersCount.textContent = stats.pendingOrders;
                
                // Load recent orders
                loadRecentOrders();
            } catch (error) {
                console.error('Error loading admin dashboard:', error);
                showNotification('Error', 'Failed to load dashboard data', 'error');
            }
        }

        async function loadRecentOrders() {
            try {
                const ordersResponse = await app.api.getAllOrders();
                const orders = ordersResponse.orders;
                const usersResponse = await app.api.getAllUsers();
                const users = usersResponse.users;
                
                // Sort orders by date (newest first)
                const sortedOrders = [...orders].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                // Get top 5 recent orders
                const recentOrders = sortedOrders.slice(0, 5);
                
                // Clear table
                elements.recentOrdersTable.innerHTML = '';
                
                if (recentOrders.length === 0) {
                    elements.recentOrdersTable.innerHTML = '<tr><td colspan="7" style="text-align: center;">No orders found</td></tr>';
                    return;
                }
                
                // Add orders to table
                recentOrders.forEach(order => {
                    const user = users.find(u => u.id === order.userId) || { name: 'Unknown User' };
                    
                    let statusClass = '';
                    switch(order.status) {
                        case 'order_placed':
                        case 'pickup_scheduled':
                            statusClass = 'status-pending';
                            break;
                        case 'picked_up':
                        case 'processing':
                            statusClass = 'status-processing';
                            break;
                        case 'completed':
                        case 'delivery_scheduled':
                        case 'delivered':
                            statusClass = 'status-completed';
                            break;
                        case 'cancelled':
                            statusClass = 'status-cancelled';
                            break;
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${order.id}</td>
                        <td>${user.name}</td>
                        <td>${order.serviceText || order.serviceType}</td>
                        <td>${formatDate(order.createdAt)}</td>
                        <td><span class="order-status ${statusClass}">${order.statusText || order.status}</span></td>
                        <td>KSH ${order.price || 0}</td>
                        <td>
                            <div class="table-actions">
                                <button class="btn view-order-details-btn" data-order-id="${order.id}">View</button>
                                <button class="btn update-order-status-btn" data-order-id="${order.id}">Update</button>
                                <button class="btn btn-danger delete-order-btn" data-order-id="${order.id}">Delete</button>
                            </div>
                        </td>
                    `;
                    
                    elements.recentOrdersTable.appendChild(row);
                });
                
                // Add event listeners to view buttons
                document.querySelectorAll('.view-order-details-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const orderId = btn.getAttribute('data-order-id');
                        showOrderDetails(orderId);
                    });
                });
                
                // Add event listeners to update buttons
                document.querySelectorAll('.update-order-status-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const orderId = btn.getAttribute('data-order-id');
                        showUpdateOrderStatusModal(orderId);
                    });
                });

                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-order-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const orderId = btn.getAttribute('data-order-id');
                        if (confirm('Are you sure you want to delete this order? This action cannot be undone.')) {
                            deleteOrder(orderId);
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading recent orders:', error);
            }
        }

        async function loadUsersTable() {
            try {
                const usersResponse = await app.api.getAllUsers();
                const users = usersResponse.users;
                
                // Clear table
                elements.usersTable.innerHTML = '';
                
                if (users.length === 0) {
                    elements.usersTable.innerHTML = '<tr><td colspan="6" style="text-align: center;">No users found</td></tr>';
                    return;
                }
                
                // Add users to table
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user._id || user.id}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.phone || 'N/A'}</td>
                        <td>${formatDate(user.createdAt || user.registrationDate)}</td>
                        <td>
                            <div class="table-actions">
                                <button class="btn view-user-details-btn" data-user-id="${user._id || user.id}">View</button>
                                <button class="btn edit-user-btn" data-user-id="${user._id || user.id}" data-user-name="${user.name}" data-user-email="${user.email}" data-user-phone="${user.phone || ''}">Edit</button>
                                <button class="btn btn-danger delete-user-btn" data-user-id="${user._id || user.id}">Delete</button>
                            </div>
                        </td>
                    `;
                    
                    elements.usersTable.appendChild(row);
                });
                
                // Add event listeners to view buttons
                document.querySelectorAll('.view-user-details-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const userId = btn.getAttribute('data-user-id');
                        showUserDetails(userId);
                    });
                });
                
                // Add event listeners to edit buttons
                document.querySelectorAll('.edit-user-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const userId = btn.getAttribute('data-user-id');
                        const userName = btn.getAttribute('data-user-name');
                        const userEmail = btn.getAttribute('data-user-email');
                        const userPhone = btn.getAttribute('data-user-phone');
                        editUser(userId, userName, userEmail, userPhone);
                    });
                });

                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-user-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const userId = btn.getAttribute('data-user-id');
                        if (confirm('Are you sure you want to delete this user? This will also delete all their orders.')) {
                            deleteUser(userId);
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading users table:', error);
            }
        }

        async function editUser(userId, currentName, currentEmail, currentPhone) {
            const newName = prompt('Edit User Name:', currentName);
            if (newName === null) return; // User cancelled
            
            const newEmail = prompt('Edit User Email:', currentEmail);
            if (newEmail === null) return;
            
            const newPhone = prompt('Edit User Phone:', currentPhone);
            if (newPhone === null) return;
            
            try {
                await app.api.updateUser(userId, {
                    name: newName,
                    email: newEmail,
                    phone: newPhone
                });
                
                showNotification('User Updated', 'User information has been updated successfully', 'success');
                loadUsersTable(); // Reload the table
            } catch (error) {
                console.error('Error updating user:', error);
                showNotification('Update Failed', error.message || 'Failed to update user', 'error');
            }
        }

        async function deleteUser(userId) {
            try {
                await app.api.deleteUser(userId);
                showNotification('User Deleted', 'User and all associated data have been deleted', 'success');
                loadUsersTable(); // Reload the table
            } catch (error) {
                console.error('Error deleting user:', error);
                showNotification('Delete Failed', error.message || 'Failed to delete user', 'error');
            }
        }

        async function loadOrdersTable() {
            try {
                // Get all orders from API
                const ordersResponse = await app.api.getAllOrders();
                const orders = ordersResponse.orders;
                
                // Get all users from API
                const usersResponse = await app.api.getAllUsers();
                const users = usersResponse.users;
                
                // Clear table
                elements.ordersTable.innerHTML = '';
                
                if (orders.length === 0) {
                    elements.ordersTable.innerHTML = '<tr><td colspan="8" style="text-align: center;">No orders found</td></tr>';
                    return;
                }
                
                // Sort orders by date (newest first)
                const sortedOrders = [...orders].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                // Add orders to table
                sortedOrders.forEach(order => {
                    const user = users.find(u => u.id === order.userId) || { name: 'Unknown User' };
                    
                    let statusClass = '';
                    switch(order.status) {
                        case 'order_placed':
                        case 'pickup_scheduled':
                            statusClass = 'status-pending';
                            break;
                        case 'picked_up':
                        case 'processing':
                            statusClass = 'status-processing';
                            break;
                        case 'completed':
                        case 'delivery_scheduled':
                        case 'delivered':
                            statusClass = 'status-completed';
                            break;
                        case 'cancelled':
                            statusClass = 'status-cancelled';
                            break;
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${order.orderId || order.id}</td>
                        <td>${order.userName || user.name}</td>
                        <td>${order.serviceText || order.serviceType}</td>
                        <td>${order.pickupDate} ${order.pickupTime}</td>
                        <td>${order.deliveryDate} ${order.deliveryTime}</td>
                        <td><span class="order-status ${statusClass}">${order.statusText || order.status}</span></td>
                        <td>KSH ${order.price || 0}</td>
                        <td>
                            <div class="table-actions">
                                <button class="btn view-order-details-btn" data-order-id="${order.orderId || order.id}">View</button>
                                <button class="btn update-order-status-btn" data-order-id="${order.orderId || order.id}">Update</button>
                                <button class="btn btn-danger delete-order-btn" data-order-id="${order.orderId || order.id}">Delete</button>
                            </div>
                        </td>
                    `;
                    
                    elements.ordersTable.appendChild(row);
                });
                
                // Add event listeners to buttons
                document.querySelectorAll('.view-order-details-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const orderId = btn.getAttribute('data-order-id');
                        showOrderDetails(orderId);
                    });
                });
                
                document.querySelectorAll('.update-order-status-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const orderId = btn.getAttribute('data-order-id');
                        showUpdateOrderStatusModal(orderId);
                    });
                });

                document.querySelectorAll('.delete-order-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const orderId = btn.getAttribute('data-order-id');
                        if (confirm('Are you sure you want to delete this order? This action cannot be undone.')) {
                            deleteOrder(orderId);
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading orders table:', error);
            }
        }

        async function loadServicesTable() {
            try {
                const response = await apiClient.get('/api/services');
                const services = response.services || [];
                
                // Clear table
                elements.servicesTable.innerHTML = '';
                
                if (services.length === 0) {
                    elements.servicesTable.innerHTML = '<tr><td colspan="5" style="text-align: center;">No services found</td></tr>';
                    return;
                }
                
                // Add services to table
                services.forEach(service => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${service.id}</td>
                        <td>${service.name}</td>
                        <td>${service.description}</td>
                        <td>KSH ${service.price}/item</td>
                        <td>
                            <div class="table-actions">
                                <button class="btn edit-service-btn" data-service-id="${service.id}">Edit</button>
                                <button class="btn btn-danger delete-service-btn" data-service-id="${service.id}">Delete</button>
                            </div>
                        </td>
                    `;
                    
                    elements.servicesTable.appendChild(row);
                });
                
                // Add event listeners to buttons
                document.querySelectorAll('.edit-service-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const serviceId = btn.getAttribute('data-service-id');
                        showEditServiceModal(serviceId);
                    });
                });

                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-service-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const serviceId = btn.getAttribute('data-service-id');
                        if (confirm('Are you sure you want to delete this service? This action cannot be undone.')) {
                            deleteService(serviceId);
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading services table:', error);
            }
        }

        async function loadAdminsTable() {
            try {
                const response = await apiClient.get('/api/admin/admins');
                const admins = response.admins || [];
                
                // Clear table
                elements.adminsTable.innerHTML = '';
                
                if (admins.length === 0) {
                    elements.adminsTable.innerHTML = '<tr><td colspan="7" style="text-align: center;">No admins found</td></tr>';
                    return;
                }
                
                // Add admins to table
                admins.forEach(admin => {
                    const row = document.createElement('tr');
                    
                    let roleBadge = '';
                    switch(admin.role) {
                        case 'super_admin':
                            roleBadge = '<span class="order-status status-completed">Super Admin</span>';
                            break;
                        case 'admin':
                            roleBadge = '<span class="order-status status-processing">Admin</span>';
                            break;
                        case 'manager':
                            roleBadge = '<span class="order-status status-pending">Manager</span>';
                            break;
                        case 'staff':
                            roleBadge = '<span class="order-status">Staff</span>';
                            break;
                    }
                    
                    let statusBadge = '';
                    if (admin.status === 'active') {
                        statusBadge = '<span class="order-status status-completed">Active</span>';
                    } else {
                        statusBadge = '<span class="order-status status-cancelled">Inactive</span>';
                    }
                    
                    row.innerHTML = `
                        <td>${admin._id || admin.id}</td>
                        <td>${admin.name}</td>
                        <td>${admin.email}</td>
                        <td>${roleBadge}</td>
                        <td>${formatDate(admin.createdAt)}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="table-actions">
                                <button class="btn edit-admin-btn" data-admin-id="${admin._id || admin.id}">Edit</button>
                                <button class="btn btn-danger delete-admin-btn" data-admin-id="${admin._id || admin.id}">Delete</button>
                            </div>
                        </td>
                    `;
                    
                    elements.adminsTable.appendChild(row);
                });
                
                // Add event listeners to buttons
                document.querySelectorAll('.edit-admin-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const adminId = btn.getAttribute('data-admin-id');
                        editAdmin(adminId);
                    });
                });
                
                document.querySelectorAll('.delete-admin-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const adminId = btn.getAttribute('data-admin-id');
                        if (confirm('Are you sure you want to delete this admin? This action cannot be undone.')) {
                            deleteAdmin(adminId);
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading admins table:', error);
            }
        }

        // Delete Functions
        async function deleteUser(userId) {
            try {
                // Delete user via API (backend will handle cascading deletes)
                await apiClient.delete(`/api/admin/users/${userId}`);
                
                // Reload users table
                loadUsersTable();
                
                // Show notification
                showNotification('User Deleted Successfully', 'User and all associated data have been deleted', 'success');
            } catch (error) {
                console.error('Error deleting user:', error);
                showNotification('Delete Failed', 'Failed to delete user', 'error');
            }
        }

        async function deleteOrder(orderId) {
            try {
                // Delete order via API
                await app.api.deleteOrder(orderId);
                
                // Reload orders table
                loadOrdersTable();
                
                // Reload recent orders in dashboard if needed
                loadRecentOrders();
                
                // Show notification
                showNotification('Order Deleted Successfully', 'Order has been deleted', 'success');
            } catch (error) {
                console.error('Error deleting order:', error);
                showNotification('Delete Failed', error.message || 'Failed to delete order', 'error');
            }
        }

        async function deleteService(serviceId) {
            try {
                // Delete service via API
                await apiClient.delete(`/api/services/${serviceId}`);
                
                // Reload services table
                loadServicesTable();
                
                // Update services on user pages
                updateUserServices();
                
                // Show notification
                showNotification('Service Deleted Successfully', 'Service has been deleted', 'success');
            } catch (error) {
                console.error('Error deleting service:', error);
                showNotification('Delete Failed', 'Failed to delete service', 'error');
            }
        }

        async function deleteAdmin(adminId) {
            try {
                // Delete admin via API
                await apiClient.delete(`/api/admin/admins/${adminId}`);
                
                // Reload admins table
                loadAdminsTable();
                
                // Show notification
                showNotification('Admin Deleted Successfully', 'Admin has been deleted', 'success');
            } catch (error) {
                console.error('Error deleting admin:', error);
                showNotification('Delete Failed', 'Failed to delete admin', 'error');
            }
        }

        // Service Management Functions
        function showAddServiceModal() {
            // Clear form
            document.getElementById('serviceName').value = '';
            document.getElementById('serviceDescription').value = '';
            document.getElementById('servicePrice').value = '';
            document.getElementById('serviceImage').value = '';
            
            // Clear file input and preview
            const fileInput = document.getElementById('serviceImageFile');
            if (fileInput) fileInput.value = '';
            const preview = document.getElementById('imagePreview');
            if (preview) preview.style.display = 'none';
            
            // Show modal
            elements.addServiceModal.classList.add('show');
        }

        async function showEditServiceModal(serviceId) {
            try {
                // Get service data from API
                const response = await apiClient.get(`/api/services/${serviceId}`);
                const service = response.service;
                
                if (!service) return;
                
                // Fill form with service data
                document.getElementById('editServiceId').value = service.id;
                document.getElementById('editServiceName').value = service.name;
                document.getElementById('editServiceDescription').value = service.description;
                document.getElementById('editServicePrice').value = service.price;
                document.getElementById('editServiceImage').value = service.image || '';
                
                // Show modal
                elements.editServiceModal.classList.add('show');
            } catch (error) {
                console.error('Error showing edit service modal:', error);
                showNotification('Error', 'Failed to load service data', 'error');
            }
        }

        async function addService() {
            try {
                const name = document.getElementById('serviceName').value;
                const description = document.getElementById('serviceDescription').value;
                const price = document.getElementById('servicePrice').value;
                const imageFile = document.getElementById('serviceImageFile').files[0];
                const imageUrl = document.getElementById('serviceImage').value;
                
                // Validate form
                if (!name || !description || !price) {
                    showNotification('Please Fill Complete Information', 'Please fill in all required fields', 'error');
                    return;
                }
                
                let finalImageUrl = imageUrl || 'default-service.jpg';
                
                // Upload image if file is selected
                if (imageFile) {
                    showNotification('Uploading Image', 'Please wait...', 'info');
                    
                    const formData = new FormData();
                    formData.append('image', imageFile);
                    
                    try {
                        const uploadResponse = await apiClient.upload('/api/upload/service-image', formData);
                        finalImageUrl = uploadResponse.imageUrl;
                    } catch (uploadError) {
                        console.error('Image upload error:', uploadError);
                        showNotification('Upload Failed', 'Failed to upload image. Using default.', 'error');
                    }
                }
                
                // Create new service
                const newService = {
                    id: Date.now().toString(),
                    name,
                    description,
                    price: parseFloat(price),
                    image: finalImageUrl
                };
                
                // Save to database via API
                await apiClient.post('/api/services', newService);
                
                // Reset form
                const addServiceForm = document.getElementById('addServiceForm');
                if (addServiceForm) addServiceForm.reset();
                
                const addServiceModal = document.getElementById('addServiceModal');
                if (addServiceModal) addServiceModal.classList.remove('show');
                
                // Reload services table
                loadServicesTable();
                
                // Update services on user pages
                updateUserServices();
                
                // Show notification
                showNotification('Service Added Successfully', `${name} has been added as a service`, 'success');
            } catch (error) {
                console.error('Error adding service:', error);
                showNotification('Add Failed', 'Failed to add service', 'error');
            }
        }

        async function updateService() {
            try {
                const serviceId = document.getElementById('editServiceId').value;
                const name = document.getElementById('editServiceName').value;
                const description = document.getElementById('editServiceDescription').value;
                const price = document.getElementById('editServicePrice').value;
                const imageFile = document.getElementById('editServiceImageFile').files[0];
                const imageUrl = document.getElementById('editServiceImage').value;
                
                // Validate form
                if (!name || !description || !price) {
                    showNotification('Please Fill Complete Information', 'Please fill in all required fields', 'error');
                    return;
                }
                
                let finalImageUrl = imageUrl || 'default-service.jpg';
                
                // Upload new image if file is selected
                if (imageFile) {
                    showNotification('Uploading Image', 'Please wait...', 'info');
                    
                    const formData = new FormData();
                    formData.append('image', imageFile);
                    
                    try {
                        const uploadResponse = await apiClient.upload('/api/upload/service-image', formData);
                        finalImageUrl = uploadResponse.imageUrl;
                    } catch (uploadError) {
                        console.error('Image upload error:', uploadError);
                        showNotification('Upload Failed', 'Failed to upload image. Keeping current.', 'error');
                    }
                }
                
                // Update service via API
                await apiClient.put(`/api/services/${serviceId}`, {
                    name,
                    description,
                    price: parseFloat(price),
                    image: finalImageUrl
                });
                
                // Reset form
                const editServiceForm = document.getElementById('editServiceForm');
                if (editServiceForm) editServiceForm.reset();
                
                const editServiceModal = document.getElementById('editServiceModal');
                if (editServiceModal) editServiceModal.classList.remove('show');
                
                // Reload services table
                loadServicesTable();
                
                // Update services on user pages
                updateUserServices();
                
                // Show notification
                showNotification('Service Updated Successfully', `${name} has been updated`, 'success');
            } catch (error) {
                console.error('Error updating service:', error);
                showNotification('Update Failed', 'Failed to update service', 'error');
            }
        }

        // User Management Functions
        async function showEditUserModal(userId) {
            try {
                // Get user data from API
                const response = await apiClient.get(`/api/users/${userId}`);
                const user = response.user;
                
                if (!user) return;
                
                // Fill form with user data
                document.getElementById('editUserId').value = user._id;
                document.getElementById('editUserName').value = user.name;
                document.getElementById('editUserEmail').value = user.email;
                document.getElementById('editUserPhone').value = user.phone;
                
                // Show modal
                elements.editUserModal.classList.add('show');
            } catch (error) {
                console.error('Error showing edit user modal:', error);
                showNotification('Error', 'Failed to load user data', 'error');
            }
        }

        async function updateUser() {
            try {
                const userId = document.getElementById('editUserId').value;
                const name = document.getElementById('editUserName').value;
                const email = document.getElementById('editUserEmail').value;
                const phone = document.getElementById('editUserPhone').value;
                
                // Validate form
                if (!name || !email || !phone) {
                    showNotification('Please Fill Complete Information', 'Please fill in all required fields', 'error');
                    return;
                }
                
                // Update user via API
                await apiClient.put(`/api/admin/users/${userId}`, {
                    name,
                    email,
                    phone
                });
                
                // Reset form
                document.getElementById('editUserForm').reset();
                elements.editUserModal.classList.remove('show');
                
                // Reload users table
                loadUsersTable();
                
                // Show notification
                showNotification('User Updated Successfully', `${name}'s information has been updated`, 'success');
            } catch (error) {
                console.error('Error updating user:', error);
                showNotification('Update Failed', 'Failed to update user', 'error');
            }
        }

        async function addAdmin() {
            try {
                const name = document.getElementById('adminName').value;
                const email = document.getElementById('adminEmail').value;
                const phone = document.getElementById('adminPhone').value;
                const password = document.getElementById('adminPassword').value;
                const role = document.getElementById('adminRole').value;
                
                // Get selected permissions
                const permissions = [];
                if (document.getElementById('permUsers').checked) permissions.push('users');
                if (document.getElementById('permOrders').checked) permissions.push('orders');
                if (document.getElementById('permServices').checked) permissions.push('services');
                if (document.getElementById('permAdmins').checked) permissions.push('admins');
                if (document.getElementById('permDatabase').checked) permissions.push('database');
                if (document.getElementById('permSettings').checked) permissions.push('settings');
                
                // Validate form
                if (!name || !email || !phone || !password || !role) {
                    showNotification('Please Fill Complete Information', 'Please fill in all required fields', 'error');
                    return;
                }
                
                // Create new admin via API
                const newAdmin = {
                    name,
                    email,
                    phone,
                    password,
                    role,
                    permissions,
                    status: 'active'
                };
                
                console.log('Sending admin data:', newAdmin);
                const response = await apiClient.post('/api/admin/admins', newAdmin);
                console.log('Admin created successfully:', response);
                
                // Reset form
                const addAdminForm = document.getElementById('addAdminForm');
                if (addAdminForm) addAdminForm.reset();
                
                const addAdminModal = document.getElementById('addAdminModal');
                if (addAdminModal) addAdminModal.classList.remove('show');
                
                // Reload admins table
                loadAdminsTable();
                
                // Show notification
                showNotification('Admin Added Successfully', `${name} has been added as an admin`, 'success');
            } catch (error) {
                console.error('Error adding admin:', error);
                const errorMsg = error.message || error.response?.data?.error || error.error || 'Failed to add admin';
                showNotification('Add Failed', errorMsg, 'error');
            }
        }

        async function editAdmin(adminId) {
            try {
                const response = await apiClient.get(`/api/admin/admins/${adminId}`);
                const admin = response.admin;
                
                if (!admin) return;
                
                // Store admin ID for update
                document.getElementById('editAdminId').value = admin._id;
                
                // Fill form with admin data
                document.getElementById('editAdminName').value = admin.name;
                document.getElementById('editAdminEmail').value = admin.email;
                document.getElementById('editAdminPhone').value = admin.phone;
                document.getElementById('editAdminRole').value = admin.role;
                document.getElementById('editAdminStatus').value = admin.status;
                
                // Set permissions checkboxes if they exist
                const permissions = admin.permissions || [];
                document.getElementById('editPermUsers').checked = permissions.includes('users');
                document.getElementById('editPermOrders').checked = permissions.includes('orders');
                document.getElementById('editPermServices').checked = permissions.includes('services');
                document.getElementById('editPermAdmins').checked = permissions.includes('admins');
                document.getElementById('editPermDatabase').checked = permissions.includes('database');
                document.getElementById('editPermSettings').checked = permissions.includes('settings');
                
                // Show modal
                elements.editAdminModal.classList.add('show');
                
                // Set current admin ID for update
                elements.editAdminForm.dataset.adminId = adminId;
            } catch (error) {
                console.error('Error editing admin:', error);
            }
        }

        async function updateAdmin() {
            try {
                const adminId = elements.editAdminForm.dataset.adminId;
                const name = document.getElementById('editAdminName').value;
                const email = document.getElementById('editAdminEmail').value;
                const phone = document.getElementById('editAdminPhone').value;
                const password = document.getElementById('editAdminPassword').value;
                const role = document.getElementById('editAdminRole').value;
                const status = document.getElementById('editAdminStatus').value;
                
                // Get selected permissions
                const permissions = [];
                if (document.getElementById('editPermUsers').checked) permissions.push('users');
                if (document.getElementById('editPermOrders').checked) permissions.push('orders');
                if (document.getElementById('editPermServices').checked) permissions.push('services');
                if (document.getElementById('editPermAdmins').checked) permissions.push('admins');
                if (document.getElementById('editPermDatabase').checked) permissions.push('database');
                if (document.getElementById('editPermSettings').checked) permissions.push('settings');
                
                // Validate form
                if (!name || !email || !phone || !role) {
                    showNotification('Please Fill Complete Information', 'Please fill in all required fields', 'error');
                    return;
                }
                
                // Update admin via API
                const updateData = {
                    name,
                    email,
                    phone,
                    role,
                    status,
                    permissions
                };
                
                // Add password if provided
                if (password) {
                    updateData.password = password;
                }
                
                await apiClient.put(`/api/admin/admins/${adminId}`, updateData);
                
                // Reset form
                elements.editAdminForm.reset();
                elements.editAdminModal.classList.remove('show');
                
                // Reload admins table
                loadAdminsTable();
                
                // Show notification
                showNotification('Admin Updated Successfully', `${name}'s information has been updated`, 'success');
            } catch (error) {
                console.error('Error updating admin:', error);
                const errorMsg = error.response?.data?.error || 'Failed to update admin';
                showNotification('Update Failed', errorMsg, 'error');
            }
        }

        async function showOrderDetails(orderId) {
            try {
                const ordersResponse = await app.api.getAllOrders();
                const usersResponse = await app.api.getAllUsers();
                
                const order = ordersResponse.orders.find(o => (o.orderId || o.id) === orderId);
                if (!order) return;
                
                const user = usersResponse.users.find(u => u._id === order.userId) || { name: order.userName || 'Unknown User', email: order.userEmail || '' };
                
                // Update modal content
                elements.orderDetailsContent.innerHTML = `
                    <div class="order-details">
                        <div class="detail-row">
                            <span class="detail-label">Order ID:</span>
                            <span>${order.id}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Customer:</span>
                            <span>${user.name} (${user.email})</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Service Type:</span>
                            <span>${order.serviceText || order.serviceType}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Number of Items:</span>
                            <span>${order.itemCount} items</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Special Instructions:</span>
                            <span>${order.specialInstructions || 'None'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Pickup Date:</span>
                            <span>${order.pickupDate} ${order.pickupTime}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Pickup Address:</span>
                            <span>${order.pickupAddress}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Pickup Contact:</span>
                            <span>${order.pickupContact} (${order.pickupPhone})</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Delivery Date:</span>
                            <span>${order.deliveryDate} ${order.deliveryTime}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Delivery Address:</span>
                            <span>${order.deliveryAddress}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Delivery Contact:</span>
                            <span>${order.deliveryContact} (${order.deliveryPhone})</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Status:</span>
                            <span>${order.statusText || order.status}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Order Date:</span>
                            <span>${formatDate(order.createdAt)}</span>
                        </div>
                        <div class="detail-row total">
                            <span class="detail-label">Total Amount:</span>
                            <span>KSH ${order.price || 0}</span>
                        </div>
                    </div>
                `;
                
                // Show modal
                elements.orderDetailsModal.classList.add('show');
            } catch (error) {
                console.error('Error showing order details:', error);
            }
        }

        async function showUserOrderDetails(order) {
            try {
                // Update modal content
                elements.userOrderDetailsContent.innerHTML = `
                    <div class="order-details">
                        <div class="detail-row">
                            <span class="detail-label">Order ID:</span>
                            <span>${order.id}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Service Type:</span>
                            <span>${order.serviceText || order.serviceType}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Number of Items:</span>
                            <span>${order.itemCount} items</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Special Instructions:</span>
                            <span>${order.specialInstructions || 'None'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Pickup Date:</span>
                            <span>${order.pickupDate} ${order.pickupTime}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Pickup Address:</span>
                            <span>${order.pickupAddress}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Pickup Contact:</span>
                            <span>${order.pickupContact} (${order.pickupPhone})</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Delivery Date:</span>
                            <span>${order.deliveryDate} ${order.deliveryTime}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Delivery Address:</span>
                            <span>${order.deliveryAddress}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Delivery Contact:</span>
                            <span>${order.deliveryContact} (${order.deliveryPhone})</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Status:</span>
                            <span>${order.statusText || order.status}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Order Date:</span>
                            <span>${formatDate(order.createdAt)}</span>
                        </div>
                        <div class="detail-row total">
                            <span class="detail-label">Total Amount:</span>
                            <span>KSH ${order.price || 0}</span>
                        </div>
                    </div>
                `;
                
                // Show modal
                elements.userOrderDetailsModal.classList.add('show');
            } catch (error) {
                console.error('Error showing user order details:', error);
            }
        }

        async function showUserDetails(userId) {
            try {
                const userResponse = await apiClient.get(`/api/users/${userId}`);
                const user = userResponse.user;
                
                if (!user) return;
                
                // Get user's orders
                const ordersResponse = await apiClient.get(`/api/orders/user/${userId}`);
                const userOrders = ordersResponse.orders || [];
                const totalSpent = userOrders.reduce((sum, order) => sum + parseFloat(order.price || 0), 0);
                
                // Update modal content
                elements.userDetailsContent.innerHTML = `
                    <div class="order-details">
                        <div class="detail-row">
                            <span class="detail-label">User ID:</span>
                            <span>${user._id}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Name:</span>
                            <span>${user.name}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Email:</span>
                            <span>${user.email}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Phone:</span>
                            <span>${user.phone}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Registration Date:</span>
                            <span>${formatDate(user.createdAt)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Total Orders:</span>
                            <span>${userOrders.length}</span>
                        </div>
                        <div class="detail-row total">
                            <span class="detail-label">Total Spent:</span>
                            <span>KSH ${totalSpent.toFixed(2)}</span>
                        </div>
                    </div>
                `;
                
                // Show modal
                elements.userDetailsModal.classList.add('show');
            } catch (error) {
                console.error('Error showing user details:', error);
            }
        }

        async function showUpdateOrderStatusModal(orderId) {
            try {
                const ordersResponse = await app.api.getAllOrders();
                const order = ordersResponse.orders.find(o => (o.orderId || o.id) === orderId);
                
                if (!order) return;
                
                // Set current order
                app.currentOrder = order;
                
                // Set current status
                elements.updateOrderStatusSelect.value = order.status;
                elements.updateOrderNotes.value = '';
                
                // Show modal
                elements.updateOrderStatusModal.classList.add('show');
            } catch (error) {
                console.error('Error showing update order status modal:', error);
            }
        }

        async function updateOrderStatus() {
            try {
                if (!app.currentOrder) return;
                
                const newStatus = elements.updateOrderStatusSelect.value;
                const notes = elements.updateOrderNotes.value;
                
                // Get status text
                let statusText = '';
                switch(newStatus) {
                    case 'order_placed':
                        statusText = 'Order Placed';
                        break;
                    case 'pickup_scheduled':
                        statusText = 'Pickup Scheduled';
                        break;
                    case 'picked_up':
                        statusText = 'Picked Up';
                        break;
                    case 'processing':
                        statusText = 'Processing';
                        break;
                    case 'completed':
                        statusText = 'Completed';
                        break;
                    case 'delivery_scheduled':
                        statusText = 'Delivery Scheduled';
                        break;
                    case 'delivered':
                        statusText = 'Delivered';
                        break;
                    case 'cancelled':
                        statusText = 'Cancelled';
                        break;
                }
                
                // Update order via API
                const orderId = app.currentOrder.orderId || app.currentOrder.id;
                await app.api.updateOrderStatus(orderId, newStatus, statusText);
                
                // Close modal
                elements.updateOrderStatusModal.classList.remove('show');
                
                // Reload current section
                const currentSection = document.querySelector('.admin-menu-item.active').getAttribute('data-section');
                switchAdminSection(currentSection);
                
                // Show notification
                showNotification('Status Updated', `Order status has been updated to ${statusText}`, 'success');
            } catch (error) {
                console.error('Error updating order status:', error);
                showNotification('Error', error.message || 'Failed to update order status', 'error');
            }
        }

        // Database Management Functions
        async function exportDatabase() {
            try {
                showNotification('Feature Disabled', 'Export feature is currently disabled. Data is stored in cloud database.', 'info');
                return;
            } catch (error) {
                console.error('Error exporting database:', error);
                showNotification('Export Failed', 'Failed to export database', 'error');
            }
        }

        function showImportModal() {
            elements.importExportTitle.textContent = 'Import Data';
            elements.importExportContent.innerHTML = `
                <div class="form-group">
                    <label for="importFile">Select a backup file to import:</label>
                    <input type="file" id="importFile" class="form-control" accept=".json">
                </div>
                <div class="form-group">
                    <p><strong>Warning:</strong> This will replace all existing data in the database. This action cannot be undone.</p>
                </div>
            `;
            
            elements.confirmImportExportBtn.textContent = 'Import';
            elements.confirmImportExportBtn.onclick = importDatabase;
            
            elements.importExportModal.classList.add('show');
        }

        async function importDatabase() {
            try {
                const fileInput = document.getElementById('importFile');
                const file = fileInput.files[0];
                
                if (!file) {
                    showNotification('Import Failed', 'Please select a file to import', 'error');
                    return;
                }
                
                showNotification('Importing', 'Importing data from file...', 'info');
                
                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        await app.db.importData(data);
                        
                        elements.importExportModal.classList.remove('show');
                        showNotification('Import Successful', 'Database has been imported successfully', 'success');
                        
                        // Reload current section
                        const currentSection = document.querySelector('.admin-menu-item.active').getAttribute('data-section');
                        switchAdminSection(currentSection);
                    } catch (error) {
                        console.error('Error parsing import file:', error);
                        showNotification('Import Failed', 'Failed to parse the import file', 'error');
                    }
                };
                
                reader.readAsText(file);
            } catch (error) {
                console.error('Error importing database:', error);
                showNotification('Import Failed', 'Failed to import database', 'error');
            }
        }

        async function clearDatabase() {
            try {
                showNotification('Clearing', 'Clearing all data from database...', 'info');
                
                await app.db.clearAllData();
                
                showNotification('Database Cleared', 'All data has been cleared from the database', 'success');
                
                // Reload current section
                const currentSection = document.querySelector('.admin-menu-item.active').getAttribute('data-section');
                switchAdminSection(currentSection);
            } catch (error) {
                console.error('Error clearing database:', error);
                showNotification('Clear Failed', 'Failed to clear database', 'error');
            }
        }

        async function createBackup() {
            try {
                showNotification('Creating Backup', 'Creating database backup...', 'info');
                
                const data = await app.db.exportAllData();
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                // Create download link
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `vwashlaundry_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Clean up
                URL.revokeObjectURL(url);
                
                showNotification('Backup Created', 'Database backup has been created successfully', 'success');
            } catch (error) {
                console.error('Error creating backup:', error);
                showNotification('Backup Failed', 'Failed to create database backup', 'error');
            }
        }

        function showRestoreModal() {
            elements.importExportTitle.textContent = 'Restore from Backup';
            elements.importExportContent.innerHTML = `
                <div class="form-group">
                    <label for="restoreFile">Select a backup file to restore:</label>
                    <input type="file" id="restoreFile" class="form-control" accept=".json">
                </div>
                <div class="form-group">
                    <p><strong>Warning:</strong> This will replace all existing data in the database. This action cannot be undone.</p>
                </div>
            `;
            
            elements.confirmImportExportBtn.textContent = 'Restore';
            elements.confirmImportExportBtn.onclick = restoreFromBackup;
            
            elements.importExportModal.classList.add('show');
        }

        async function restoreFromBackup() {
            try {
                const fileInput = document.getElementById('restoreFile');
                const file = fileInput.files[0];
                
                if (!file) {
                    showNotification('Restore Failed', 'Please select a file to restore', 'error');
                    return;
                }
                
                showNotification('Restoring', 'Restoring data from backup...', 'info');
                
                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        await app.db.importData(data);
                        
                        elements.importExportModal.classList.remove('show');
                        showNotification('Restore Successful', 'Database has been restored from backup', 'success');
                        
                        // Reload current section
                        const currentSection = document.querySelector('.admin-menu-item.active').getAttribute('data-section');
                        switchAdminSection(currentSection);
                    } catch (error) {
                        console.error('Error parsing restore file:', error);
                        showNotification('Restore Failed', 'Failed to parse the restore file', 'error');
                    }
                };
                
                reader.readAsText(file);
            } catch (error) {
                console.error('Error restoring from backup:', error);
                showNotification('Restore Failed', 'Failed to restore from backup', 'error');
            }
        }

        // Service Management Functions
        async function updateUserServices() {
            try {
                // Hardcoded services (can be replaced with API call later)
                const services = [
                    {
                        id: 'duvet',
                        name: 'Duvet (all sizes)',
                        description: 'Professional cleaning for all sizes of duvets using specialized equipment for thorough cleaning.',
                        price: 500,
                        image: 'duvet.jpeg'
                    },
                    {
                        id: 'beddings',
                        name: 'Beddings',
                        description: 'Complete bedding cleaning including sheets, pillowcases, and blankets.',
                        price: 400,
                        image: 'beddings.jpeg'
                    },
                    {
                        id: 'mat',
                        name: 'Mat (fluffy & hard)',
                        description: 'Specialized cleaning for all types of mats, from fluffy to hard varieties.',
                        price: 300,
                        image: 'carpet.jpeg'
                    },
                    {
                        id: 'shoes',
                        name: 'Shoes',
                        description: 'Professional cleaning and care for all types of shoes.',
                        price: 350,
                        image: 'shoes.jpeg'
                    },
                    {
                        id: 'clothes',
                        name: 'Clothes',
                        description: 'Professional cleaning for all types of clothes.',
                        price: 200,
                        image: 'clothes.jpeg'
                    },
                    {
                        id: 'jacket',
                        name: 'Jacket',
                        description: 'Specialized cleaning for jackets of all materials.',
                        price: 450,
                        image: 'jackets.jpeg'
                    },
                    {
                        id: 'teddy',
                        name: 'Teddy bear (Dolly)',
                        description: 'Gentle cleaning for stuffed animals and teddy bears.',
                        price: 250,
                        image: 'teddybear.jpeg'
                    },
                    {
                        id: 'ironing',
                        name: 'Ironing',
                        description: 'Professional ironing service for all types of clothes.',
                        price: 50,
                        image: 'ironing.jpeg'
                    }
                ];
                
                // Update services on home page
                updateServiceCards('homeServicesGrid', services);
                
                // Update services on services page
                updateServiceCards('servicesPageGrid', services);
                
                // Update booking form service options
                updateBookingFormServices(services);
            } catch (error) {
                console.error('Error updating user services:', error);
            }
        }

        // Helper function to update service cards
        function updateServiceCards(containerId, services) {
            const container = document.getElementById(containerId);
            
            if (!container) return;
            
            container.innerHTML = '';
            
            if (services.length === 0) {
                container.innerHTML = '<p>No services available at the moment.</p>';
                return;
            }
            
            services.forEach(service => {
                const serviceCard = document.createElement('div');
                serviceCard.className = 'service-card';
                serviceCard.innerHTML = `
                    <div class="service-image" style="background-image: url('${service.image || 'default-service.jpg'}');"></div>
                    <div class="service-content">
                        <h3 class="service-title">${service.name}</h3>
                        <p class="service-description">${service.description}</p>
                        <div class="service-price">KSH ${service.price}/item starting</div>
                        <button class="btn book-service-btn" data-service="${service.id}">Book Now</button>
                    </div>
                `;
                
                container.appendChild(serviceCard);
            });
            
            // Reattach event listeners to book buttons
            container.querySelectorAll('.book-service-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const service = btn.getAttribute('data-service');
                    if (app.user) {
                        navigateToPage('booking');
                        elements.serviceType.value = service;
                    } else {
                        showNotification('Please Login', 'You need to login to book a service', 'info');
                        showAuthModal('login');
                    }
                });
            });
        }

        // Helper function to update booking form services
        function updateBookingFormServices(services) {
            const serviceTypeSelect = document.getElementById('serviceType');
            
            // Clear existing options except the first one
            serviceTypeSelect.innerHTML = '<option value="">Please select a service type</option>';
            
            // Add services from database
            services.forEach(service => {
                const option = document.createElement('option');
                option.value = service.id;
                option.textContent = `${service.name} - KSH ${service.price}/item starting`;
                serviceTypeSelect.appendChild(option);
            });
        }

        // Settings Functions
        async function saveCompanySettings() {
            try {
                const companyName = document.getElementById('companyName').value;
                const companyEmail = document.getElementById('companyEmail').value;
                const companyPhone = document.getElementById('companyPhone').value;
                
                // Save settings to database
                await app.db.update('settings', { key: 'companyName', value: companyName });
                await app.db.update('settings', { key: 'companyEmail', value: companyEmail });
                await app.db.update('settings', { key: 'companyPhone', value: companyPhone });
                
                showNotification('Settings Saved', 'Company settings have been updated successfully', 'success');
            } catch (error) {
                console.error('Error saving company settings:', error);
                showNotification('Save Failed', 'Failed to save company settings', 'error');
            }
        }

        async function saveSettings() {
            try {
                const emailNotifications = document.getElementById('emailNotifications').checked;
                const smsNotifications = document.getElementById('smsNotifications').checked;
                const promoNotifications = document.getElementById('promoNotifications').checked;
                
                // Save settings to localStorage
                const settings = {
                    emailNotifications,
                    smsNotifications,
                    promoNotifications
                };
                localStorage.setItem('userSettings_' + app.user.id, JSON.stringify(settings));
                
                showNotification('Settings Saved', 'Your settings have been updated successfully', 'success');
            } catch (error) {
                console.error('Error saving settings:', error);
                showNotification('Save Failed', 'Failed to save settings', 'error');
            }
        }

        // Booking Functions
        function goToBookingStep(step) {
            // Update steps
            elements.bookingSteps.forEach((s, index) => {
                if (index < step - 1) {
                    s.classList.add('completed');
                    s.classList.remove('active');
                } else if (index === step - 1) {
                    s.classList.add('active');
                    s.classList.remove('completed');
                } else {
                    s.classList.remove('active', 'completed');
                }
            });
            
            // Update content
            elements.bookingFormContents.forEach((content, index) => {
                if (index === step - 1) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
            
            app.currentBookingStep = step;
        }

        function validateStep1() {
            const serviceType = elements.serviceType.value;
            const itemCount = elements.itemCount.value;
            
            if (!serviceType) {
                showNotification('Please Select Service Type', 'Please select the service type you need', 'error');
                return false;
            }
            
            if (!itemCount || itemCount < 1) {
                showNotification('Please Enter Item Count', 'Please enter the number of items to be cleaned', 'error');
                return false;
            }
            
            return true;
        }

        function validateStep2() {
            const pickupDate = elements.pickupDate.value;
            const pickupTime = elements.pickupTime.value;
            const pickupAddress = elements.pickupAddress.value;
            const pickupContact = elements.pickupContact.value;
            const pickupPhone = elements.pickupPhone.value;
            
            if (!pickupDate) {
                showNotification('Please Select Pickup Date', 'Please select a pickup date', 'error');
                return false;
            }
            
            if (!pickupTime) {
                showNotification('Please Select Pickup Time', 'Please select a pickup time slot', 'error');
                return false;
            }
            
            if (!pickupAddress) {
                showNotification('Please Enter Pickup Address', 'Please enter the pickup address', 'error');
                return false;
            }
            
            if (!pickupContact) {
                showNotification('Please Enter Contact Person', 'Please enter the pickup contact person', 'error');
                return false;
            }
            
            if (!pickupPhone) {
                showNotification('Please Enter Phone Number', 'Please enter the pickup phone number', 'error');
                return false;
            }
            
            return true;
        }

        function validateStep3() {
            const deliveryDate = elements.deliveryDate.value;
            const deliveryTime = elements.deliveryTime.value;
            const deliveryAddress = elements.deliveryAddress.value;
            const deliveryContact = elements.deliveryContact.value;
            const deliveryPhone = elements.deliveryPhone.value;
            
            if (!deliveryDate) {
                showNotification('Please Select Delivery Date', 'Please select a delivery date', 'error');
                return false;
            }
            
            if (!deliveryTime) {
                showNotification('Please Select Delivery Time', 'Please select a delivery time slot', 'error');
                return false;
            }
            
            if (!deliveryAddress) {
                showNotification('Please Enter Delivery Address', 'Please enter the delivery address', 'error');
                return false;
            }
            
            if (!deliveryContact) {
                showNotification('Please Enter Contact Person', 'Please enter the delivery contact person', 'error');
                return false;
            }
            
            if (!deliveryPhone) {
                showNotification('Please Enter Phone Number', 'Please enter the delivery phone number', 'error');
                return false;
            }
            
            return true;
        }

        function updateOrderSummary() {
            const serviceType = elements.serviceType.value;
            const serviceText = elements.serviceType.options[elements.serviceType.selectedIndex].text;
            const itemCount = elements.itemCount.value;
            const specialInstructions = elements.specialInstructions.value || 'None';
            const pickupDate = elements.pickupDate.value;
            const pickupTime = elements.pickupTime.value;
            const pickupAddress = elements.pickupAddress.value;
            const deliveryDate = elements.deliveryDate.value;
            const deliveryTime = elements.deliveryTime.value;
            const deliveryAddress = elements.deliveryAddress.value;
            
            // Calculate price based on service type and item count
            let basePrice = 0;
            const services = app.services || [];
            const selectedService = services.find(s => s.id === serviceType);
            
            if (selectedService) {
                basePrice = selectedService.price;
            } else {
                // Fallback pricing
                switch(serviceType) {
                    case 'duvet':
                        basePrice = 500;
                        break;
                    case 'beddings':
                        basePrice = 400;
                        break;
                    case 'mat':
                        basePrice = 300;
                        break;
                    case 'shoes':
                        basePrice = 350;
                        break;
                    case 'clothes':
                        basePrice = 200;
                        break;
                    case 'jacket':
                        basePrice = 450;
                        break;
                    case 'teddy':
                        basePrice = 250;
                        break;
                    case 'ironing':
                        basePrice = 50;
                        break;
                }
            }
            
            const totalPrice = basePrice * itemCount;
            
            // Update confirmation elements
            elements.confirmServiceType.textContent = serviceText;
            elements.confirmItemCount.textContent = itemCount + ' items';
            elements.confirmPickupTime.textContent = `${pickupDate} ${pickupTime}`;
            elements.confirmPickupAddress.textContent = pickupAddress;
            elements.confirmDeliveryTime.textContent = `${deliveryDate} ${deliveryTime}`;
            elements.confirmDeliveryAddress.textContent = deliveryAddress;
            elements.confirmSpecialInstructions.textContent = specialInstructions;
            elements.confirmTotalPrice.textContent = `KSH ${totalPrice}`;
        }

        async function submitBooking() {
            try {
                // Check if user is logged in
                if (!app.user) {
                    showNotification('Login Required', 'Please login to book a service', 'error');
                    elements.authModal.classList.add('show');
                    return;
                }
                
                // Get the selected service details
                const serviceType = elements.serviceType.value;
                const serviceText = elements.serviceType.options[elements.serviceType.selectedIndex].text;
                
                // Calculate price (simple pricing based on service type)
                const itemCount = parseInt(elements.itemCount.value);
                let basePrice = 200;
                switch(serviceType) {
                    case 'duvet': basePrice = 500; break;
                    case 'beddings': basePrice = 400; break;
                    case 'mat': basePrice = 300; break;
                    case 'shoes': basePrice = 350; break;
                    case 'clothes': basePrice = 200; break;
                    case 'jacket': basePrice = 450; break;
                    case 'teddy': basePrice = 250; break;
                    case 'ironing': basePrice = 50; break;
                }
                
                // Create order object
                const order = {
                    id: 'ORD' + Date.now().toString().slice(-8),
                    serviceType: serviceType,
                    serviceText: serviceText,
                    itemCount: itemCount,
                    specialInstructions: elements.specialInstructions.value || 'None',
                    pickupDate: elements.pickupDate.value,
                    pickupTime: elements.pickupTime.value,
                    pickupAddress: elements.pickupAddress.value,
                    pickupContact: elements.pickupContact.value,
                    pickupPhone: elements.pickupPhone.value,
                    deliveryDate: elements.deliveryDate.value,
                    deliveryTime: elements.deliveryTime.value,
                    deliveryAddress: elements.deliveryAddress.value,
                    deliveryContact: elements.deliveryContact.value,
                    deliveryPhone: elements.deliveryPhone.value,
                    status: 'order_placed',
                    statusText: 'Order Placed',
                    price: basePrice * itemCount
                };
                
                // Save order via API
                const response = await app.api.createOrder(order);
                
                // Set current order
                app.currentOrder = response.order;
                
                // Update confirmation page
                elements.confirmationOrderId.textContent = order.id;
                elements.confirmationServiceType.textContent = order.serviceText;
                elements.confirmationItemCount.textContent = order.itemCount + ' items';
                elements.confirmationPickupTime.textContent = `${order.pickupDate} ${order.pickupTime}`;
                elements.confirmationDeliveryTime.textContent = `${order.deliveryDate} ${order.deliveryTime}`;
                elements.confirmationTotalPrice.textContent = `KSH ${order.price}`;
                
                // Reset booking form
                resetBookingForm();
                
                // Navigate to confirmation page
                navigateToPage('confirmation');
                
                // Show notification
                showNotification('Order Submitted Successfully', `Your order ${order.id} has been successfully submitted`, 'success');
            } catch (error) {
                console.error('Error submitting booking:', error);
                showNotification('Booking Error', error.message || 'Failed to submit your order', 'error');
            }
        }

        function calculatePrice(service) {
            const itemCount = parseInt(elements.itemCount.value);
            
            if (service) {
                return service.price * itemCount;
            }
            
            // Fallback pricing
            const serviceType = elements.serviceType.value;
            let basePrice = 0;
            
            switch(serviceType) {
                case 'duvet':
                    basePrice = 500;
                    break;
                case 'beddings':
                    basePrice = 400;
                    break;
                case 'mat':
                    basePrice = 300;
                    break;
                case 'shoes':
                    basePrice = 350;
                    break;
                case 'clothes':
                    basePrice = 200;
                    break;
                case 'jacket':
                    basePrice = 450;
                    break;
                case 'teddy':
                    basePrice = 250;
                    break;
                case 'ironing':
                    basePrice = 50;
                    break;
            }
            
            return basePrice * itemCount;
        }

        function resetBookingForm() {
            // Reset form fields
            elements.serviceType.value = '';
            elements.itemCount.value = '1';
            elements.specialInstructions.value = '';
            elements.pickupDate.value = '';
            elements.pickupTime.value = '';
            elements.pickupAddress.value = '';
            elements.pickupContact.value = '';
            elements.pickupPhone.value = '';
            elements.deliveryDate.value = '';
            elements.deliveryTime.value = '';
            elements.deliveryAddress.value = '';
            elements.deliveryContact.value = '';
            elements.deliveryPhone.value = '';
            elements.sameAsPickup.checked = false;
            elements.deliveryAddressForm.style.display = 'grid';
            
            // Reset to step 1
            goToBookingStep(1);
        }

        // Dashboard Functions
        function switchDashboardTab(tab) {
            // Update menu items
            elements.dashboardMenuItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-tab') === tab) {
                    item.classList.add('active');
                }
            });
            
            // Update tabs
            elements.dashboardTabs.forEach(t => {
                t.classList.remove('active');
                if (t.id === tab + 'Tab') {
                    t.classList.add('active');
                }
            });
            
            // Load tab-specific data
            if (tab === 'addresses') {
                loadAddresses();
            } else if (tab === 'settings') {
                loadSettings();
            }
        }

        async function loadOrders() {
            try {
                if (!app.user) {
                    elements.ordersList.innerHTML = '<p>Please login to view your orders</p>';
                    return;
                }
                
                // Get orders from API
                const response = await app.api.getUserOrders();
                const userOrders = response.orders;
                
                // Clear orders list
                elements.ordersList.innerHTML = '';
                
                if (userOrders.length === 0) {
                    elements.ordersList.innerHTML = '<p>You don\'t have any orders yet</p>';
                    return;
                }
                
                // Add orders to list
                userOrders.forEach(order => {
                    const orderCard = document.createElement('div');
                    orderCard.className = 'order-card';
                    
                    let statusClass = '';
                    switch(order.status) {
                        case 'order_placed':
                        case 'pickup_scheduled':
                            statusClass = 'status-pending';
                            break;
                        case 'picked_up':
                        case 'processing':
                            statusClass = 'status-processing';
                            break;
                        case 'completed':
                        case 'delivery_scheduled':
                        case 'delivered':
                            statusClass = 'status-completed';
                            break;
                    }
                    
                    orderCard.innerHTML = `
                        <div class="order-header">
                            <div class="order-id">Order Number: ${order.orderId || order.id}</div>
                            <div class="order-status ${statusClass}">${order.statusText}</div>
                        </div>
                        <div class="order-details">
                            <div class="detail-row">
                                <span class="detail-label">Service Type:</span>
                                <span>${order.serviceText}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Number of Items:</span>
                                <span>${order.itemCount} items</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Pickup Time:</span>
                                <span>${order.pickupDate} ${order.pickupTime}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Delivery Time:</span>
                                <span>${order.deliveryDate} ${order.deliveryTime}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Estimated Cost:</span>
                                <span>KSH ${order.price}</span>
                            </div>
                        </div>
                        <div class="order-actions">
                            <button class="btn view-order-btn" data-order-id="${order.orderId || order.id}">View Details</button>
                            ${order.status === 'order_placed' ? `<button class="btn cancel-order-btn" data-order-id="${order.orderId || order.id}">Cancel Order</button>` : ''}
                        </div>
                    `;
                    
                    elements.ordersList.appendChild(orderCard);
                });
                
                // Add event listeners to order buttons
                document.querySelectorAll('.view-order-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const orderId = btn.getAttribute('data-order-id');
                        viewOrder(orderId);
                    });
                });
                
                document.querySelectorAll('.cancel-order-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const orderId = btn.getAttribute('data-order-id');
                        if (confirm('Are you sure you want to cancel this order?')) {
                            cancelOrder(orderId);
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        async function viewOrder(orderId) {
            try {
                const response = await app.api.getUserOrders();
                const order = response.orders.find(o => (o.orderId || o.id) === orderId);
                
                if (order) {
                    showUserOrderDetails(order);
                }
            } catch (error) {
                console.error('Error viewing order:', error);
                showNotification('Error', 'Failed to load order details', 'error');
            }
        }

        async function cancelOrder(orderId) {
            try {
                // Update order status to cancelled via API
                await app.api.updateOrderStatus(orderId, 'cancelled', 'Cancelled');
                
                // Reload orders
                loadOrders();
                
                // Show notification
                showNotification('Cancellation Successful', 'Order has been cancelled', 'success');
            } catch (error) {
                console.error('Error cancelling order:', error);
                showNotification('Cancellation Failed', error.message || 'Failed to cancel order', 'error');
            }
        }

        async function updateProfile() {
            try {
                const name = document.getElementById('profileName').value;
                const email = document.getElementById('profileEmail').value;
                const phone = document.getElementById('profilePhone').value;
                
                // Call API to update profile
                const response = await app.api.updateProfile({ name, email, phone });
                
                // Update user in app state with response data
                app.user = response.user;
                
                // Update user in localStorage
                localStorage.setItem('laundryUser', JSON.stringify(app.user));
                
                // Update UI
                updateUserUI();
                
                // Show notification
                showNotification('Update Successful', 'Your profile information has been updated successfully', 'success');
            } catch (error) {
                console.error('Error updating profile:', error);
                showNotification('Update Failed', error.message || 'Failed to update profile', 'error');
            }
        }

        async function changePassword() {
            try {
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmNewPassword = document.getElementById('confirmNewPassword').value;
                
                // Validate inputs
                if (!currentPassword || !newPassword || !confirmNewPassword) {
                    showNotification('Validation Error', 'Please fill in all password fields', 'error');
                    return;
                }
                
                // Check if new passwords match
                if (newPassword !== confirmNewPassword) {
                    showNotification('Validation Error', 'New passwords do not match', 'error');
                    return;
                }
                
                // Check password length
                if (newPassword.length < 6) {
                    showNotification('Validation Error', 'New password must be at least 6 characters long', 'error');
                    return;
                }
                
                // Call API to change password
                await app.api.changePassword(currentPassword, newPassword);
                
                // Update password in local user object (for localStorage compatibility)
                app.user.password = newPassword;
                localStorage.setItem('laundryUser', JSON.stringify(app.user));
                
                // Close modal and reset form
                elements.changePasswordModal.classList.remove('show');
                elements.changePasswordForm.reset();
                
                // Show success notification
                showNotification('Password Changed', 'Your password has been successfully changed', 'success');
            } catch (error) {
                console.error('Error changing password:', error);
                showNotification('Change Password Failed', error.message || 'Failed to change password', 'error');
            }
        }

        async function loadAddresses() {
            try {
                // Get addresses from localStorage
                const addressesStr = localStorage.getItem('userAddresses_' + app.user.id);
                const userAddresses = addressesStr ? JSON.parse(addressesStr) : [];
                
                // Clear addresses list
                elements.addressesList.innerHTML = '';
                
                if (userAddresses.length === 0) {
                    elements.addressesList.innerHTML = '<p>You haven\'t added any addresses yet</p>';
                    return;
                }
                
                // Add addresses to list
                userAddresses.forEach(address => {
                    const addressCard = document.createElement('div');
                    addressCard.className = 'order-card';
                    
                    addressCard.innerHTML = `
                        <div class="order-header">
                            <div class="order-id">${address.name}</div>
                            ${address.isDefault ? '<div class="order-status status-completed">Default Address</div>' : ''}
                        </div>
                        <div class="order-details">
                            <div class="detail-row">
                                <span class="detail-label">Address:</span>
                                <span>${address.detail}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Contact:</span>
                                <span>${address.contact}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Phone:</span>
                                <span>${address.phone}</span>
                            </div>
                        </div>
                        <div class="order-actions">
                            <button class="btn edit-address-btn" data-address-id="${address.id}">Edit</button>
                            <button class="btn delete-address-btn" data-address-id="${address.id}">Delete</button>
                        </div>
                    `;
                    
                    elements.addressesList.appendChild(addressCard);
                });
                
                // Add event listeners to address buttons
                document.querySelectorAll('.edit-address-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const addressId = btn.getAttribute('data-address-id');
                        editAddress(addressId);
                    });
                });
                
                document.querySelectorAll('.delete-address-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const addressId = btn.getAttribute('data-address-id');
                        if (confirm('Are you sure you want to delete this address?')) {
                            deleteAddress(addressId);
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading addresses:', error);
            }
        }

        async function loadSettings() {
            try {
                // Get settings from localStorage
                const settingsStr = localStorage.getItem('userSettings_' + app.user.id);
                const settings = settingsStr ? JSON.parse(settingsStr) : {
                    emailNotifications: true,
                    smsNotifications: true,
                    promoNotifications: false
                };
                
                // Set checkbox values
                document.getElementById('emailNotifications').checked = settings.emailNotifications !== false;
                document.getElementById('smsNotifications').checked = settings.smsNotifications !== false;
                document.getElementById('promoNotifications').checked = settings.promoNotifications === true;
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        async function saveAddress() {
            try {
                const name = document.getElementById('addressName').value;
                const detail = document.getElementById('addressDetail').value;
                const contact = document.getElementById('addressContact').value;
                const phone = document.getElementById('addressPhone').value;
                const isDefault = document.getElementById('addressDefault').checked;
                
                // Validate form
                if (!name || !detail || !contact || !phone) {
                    showNotification('Please Fill Complete Information', 'Please fill in all required fields', 'error');
                    return;
                }
                
                // Get existing addresses from localStorage
                const addressesStr = localStorage.getItem('userAddresses_' + app.user.id);
                const addresses = addressesStr ? JSON.parse(addressesStr) : [];
                
                // If this is the default address, unset other default addresses
                if (isDefault) {
                    addresses.forEach(addr => {
                        addr.isDefault = false;
                    });
                }
                
                // Create address object
                const address = {
                    id: Date.now().toString(),
                    userId: app.user.id,
                    name,
                    detail,
                    contact,
                    phone,
                    isDefault
                };
                
                // Add address to array
                addresses.push(address);
                
                // Save to localStorage
                localStorage.setItem('userAddresses_' + app.user.id, JSON.stringify(addresses));
                
                // Reset form
                elements.addressForm.reset();
                elements.addressModal.classList.remove('show');
                
                // Reload addresses
                loadAddresses();
                
                // Show notification
                showNotification('Added Successfully', 'Address has been successfully added', 'success');
            } catch (error) {
                console.error('Error saving address:', error);
                showNotification('Save Failed', 'Failed to save address', 'error');
            }
        }

        async function editAddress(addressId) {
            try {
                const addresses = await app.db.getAll('addresses');
                const address = addresses.find(a => a.id === addressId);
                
                if (!address) return;
                
                // Fill form with address data
                document.getElementById('addressName').value = address.name;
                document.getElementById('addressDetail').value = address.detail;
                document.getElementById('addressContact').value = address.contact;
                document.getElementById('addressPhone').value = address.phone;
                document.getElementById('addressDefault').checked = address.isDefault;
                
                // Show modal
                elements.addressModal.classList.add('show');
                
                // Change save button to update
                elements.saveAddressBtn.textContent = 'Update';
                elements.saveAddressBtn.onclick = () => updateAddress(addressId);
            } catch (error) {
                console.error('Error editing address:', error);
            }
        }

        async function updateAddress(addressId) {
            try {
                const name = document.getElementById('addressName').value;
                const detail = document.getElementById('addressDetail').value;
                const contact = document.getElementById('addressContact').value;
                const phone = document.getElementById('addressPhone').value;
                const isDefault = document.getElementById('addressDefault').checked;
                
                // Validate form
                if (!name || !detail || !contact || !phone) {
                    showNotification('Please Fill Complete Information', 'Please fill in all required fields', 'error');
                    return;
                }
                
                // Find address in database
                const addresses = await app.db.getAll('addresses');
                const address = addresses.find(a => a.id === addressId);
                
                if (!address) return;
                
                // If this is the default address, unset other default addresses
                if (isDefault) {
                    const userAddresses = addresses.filter(a => a.userId === app.user.id);
                    
                    for (const userAddress of userAddresses) {
                        if (userAddress.isDefault && userAddress.id !== addressId) {
                            userAddress.isDefault = false;
                            await app.db.update('addresses', userAddress);
                        }
                    }
                }
                
                // Update address
                address.name = name;
                address.detail = detail;
                address.contact = contact;
                address.phone = phone;
                address.isDefault = isDefault;
                
                // Save to database
                await app.db.update('addresses', address);
                
                // Reset form
                elements.addressForm.reset();
                elements.addressModal.classList.remove('show');
                
                // Reset save button
                elements.saveAddressBtn.textContent = 'Save';
                elements.saveAddressBtn.onclick = saveAddress;
                
                // Reload addresses
                loadAddresses();
                
                // Show notification
                showNotification('Update Successful', 'Address has been successfully updated', 'success');
            } catch (error) {
                console.error('Error updating address:', error);
                showNotification('Update Failed', 'Failed to update address', 'error');
            }
        }

        async function deleteAddress(addressId) {
            try {
                // Get addresses from localStorage
                const addressesStr = localStorage.getItem('userAddresses_' + app.user.id);
                let addresses = addressesStr ? JSON.parse(addressesStr) : [];
                
                // Filter out the deleted address
                addresses = addresses.filter(addr => addr.id !== addressId);
                
                // Save back to localStorage
                localStorage.setItem('userAddresses_' + app.user.id, JSON.stringify(addresses));
                
                // Reload addresses
                loadAddresses();
                
                // Show notification
                showNotification('Delete Successful', 'Address has been successfully deleted', 'success');
            } catch (error) {
                console.error('Error deleting address:', error);
                showNotification('Delete Failed', 'Failed to delete address', 'error');
            }
        }

        // Utility Functions
        function showNotification(title, message, type = 'info') {
            // Update notification content
            elements.notification.querySelector('.notification-title').textContent = title;
            elements.notification.querySelector('.notification-message').textContent = message;
            
            // Update notification icon and class
            const icon = elements.notification.querySelector('.notification-icon i');
            elements.notification.className = 'notification';
            
            switch(type) {
                case 'success':
                    icon.className = 'fas fa-check-circle';
                    elements.notification.classList.add('success');
                    break;
                case 'error':
                    icon.className = 'fas fa-exclamation-circle';
                    elements.notification.classList.add('error');
                    break;
                case 'info':
                default:
                    icon.className = 'fas fa-info-circle';
                    elements.notification.classList.add('info');
                    break;
            }
            
            // Show notification
            elements.notification.classList.add('show');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 5000);
        }

        function formatDateTime(date) {
            const d = new Date(date);
            return `${d.getFullYear()}-${padZero(d.getMonth() + 1)}-${padZero(d.getDate())} ${padZero(d.getHours())}:${padZero(d.getMinutes())}`;
        }

        function formatDate(date) {
            const d = new Date(date);
            return `${d.getFullYear()}-${padZero(d.getMonth() + 1)}-${padZero(d.getDate())}`;
        }

        function padZero(num) {
            return num < 10 ? '0' + num : num;
        }

        async function loadSampleData() {
            // DISABLED - Not needed with backend API
            console.log('Sample data loading disabled - using backend database');
            return;
            /* COMMENTED OUT
            try {
                // Check if there are any users in the database
                const users = await app.db.getAll('users');
                
                if (users.length === 0) {
                    // Create sample user
                    const sampleUser = {
                        id: '1',
                        name: 'John Doe',
                        email: 'john@example.com',
                        phone: '1234567890',
                        password: 'password123',
                        registrationDate: new Date().toISOString()
                    };
                    
                    await app.db.add('users', sampleUser);
                }
                
                // Check if there are any orders in the database
                const orders = await app.db.getAll('orders');
                
                if (orders.length === 0) {
                    // Create sample orders
                    const sampleOrders = [
                        {
                            id: 'ORD12345678',
                            userId: '1',
                            serviceType: 'duvet',
                            serviceText: 'Duvet (all sizes) - KSH 500/item starting',
                            itemCount: '2',
                            specialInstructions: 'Please use mild detergent',
                            pickupDate: '2023-06-15',
                            pickupTime: '09:00-11:00',
                            pickupAddress: '123 Main St, Nairobi, Kenya',
                            pickupContact: 'John Doe',
                            pickupPhone: '1234567890',
                            deliveryDate: '2023-06-17',
                            deliveryTime: '15:00-17:00',
                            deliveryAddress: '123 Main St, Nairobi, Kenya',
                            deliveryContact: 'John Doe',
                            deliveryPhone: '1234567890',
                            status: 'processing',
                            statusText: 'Processing',
                            createdAt: '2023-06-14T10:30:00Z',
                            price: 1000
                        },
                        {
                            id: 'ORD87654321',
                            userId: '1',
                            serviceType: 'shoes',
                            serviceText: 'Shoes - KSH 350/pair starting',
                            itemCount: '3',
                            specialInstructions: 'None',
                            pickupDate: '2023-06-10',
                            pickupTime: '13:00-15:00',
                            pickupAddress: '123 Main St, Nairobi, Kenya',
                            pickupContact: 'John Doe',
                            pickupPhone: '1234567890',
                            deliveryDate: '2023-06-12',
                            deliveryTime: '17:00-19:00',
                            deliveryAddress: '123 Main St, Nairobi, Kenya',
                            deliveryContact: 'John Doe',
                            deliveryPhone: '1234567890',
                            status: 'delivered',
                            statusText: 'Delivered',
                            createdAt: '2023-06-09T16:45:00Z',
                            price: 1050
                        }
                    ];
                    
                    for (const order of sampleOrders) {
                        await app.db.add('orders', order);
                    }
                }
                
                // Check if there are any addresses in the database
                const addresses = await app.db.getAll('addresses');
                
                if (addresses.length === 0) {
                    // Create sample addresses
                    const sampleAddresses = [
                        {
                            id: '1',
                            userId: '1',
                            name: 'Home',
                            detail: '123 Main St, Nairobi, Kenya',
                            contact: 'John Doe',
                            phone: '1234567890',
                            isDefault: true
                        },
                        {
                            id: '2',
                            userId: '1',
                            name: 'Office',
                            detail: '456 Business Ave, Nairobi, Kenya',
                            contact: 'John Doe',
                            phone: '1234567890',
                            isDefault: false
                        }
                    ];
                    
                    for (const address of sampleAddresses) {
                        await app.db.add('addresses', address);
                    }
                }
                
                // Check if there are any services in the database
                const services = await app.db.getAll('services');
                
                if (services.length === 0) {
                    // Create sample services with images
                    const sampleServices = [
                        {
                            id: 'duvet',
                            name: 'Duvet (all sizes)',
                            description: 'Professional cleaning for all sizes of duvets using specialized equipment for thorough cleaning.',
                            price: 500,
                            image: 'duvet.jpeg'
                        },
                        {
                            id: 'beddings',
                            name: 'Beddings',
                            description: 'Complete bedding cleaning including sheets, pillowcases, and blankets.',
                            price: 400,
                            image: 'beddings.jpeg'
                        },
                        {
                            id: 'mat',
                            name: 'Mat (fluffy & hard)',
                            description: 'Specialized cleaning for all types of mats, from fluffy to hard varieties.',
                            price: 300,
                            image: 'mat.jpeg'
                        },
                        {
                            id: 'shoes',
                            name: 'Shoes',
                            description: 'Professional cleaning and care for all types of shoes.',
                            price: 350,
                            image: 'shoes.jpeg'
                        },
                        {
                            id: 'clothes',
                            name: 'Clothes',
                            description: 'Professional cleaning for all types of clothes.',
                            price: 200,
                            image: 'clothes.jpeg'
                        },
                        {
                            id: 'jacket',
                            name: 'Jacket',
                            description: 'Specialized cleaning for jackets of all materials.',
                            price: 450,
                            image: 'jackets.jpeg'
                        },
                        {
                            id: 'teddy',
                            name: 'Teddy bear (Dolly)',
                            description: 'Gentle cleaning for stuffed animals and teddy bears.',
                            price: 250,
                            image: 'teddybear.jpeg'
                        },
                        {
                            id: 'ironing',
                            name: 'Ironing/Kupiga Pasi',
                            description: 'Professional ironing services for all types of garments.',
                            price: 50,
                            image: 'ironing.jpeg'
                        }
                    ];
                    
                    for (const service of sampleServices) {
                        await app.db.add('services', service);
                    }
                }
                
                // Check if there are any admins in the database
                const admins = await app.db.getAll('admins');
                
                if (admins.length === 0) {
                    // Create sample admin
                    const sampleAdmin = {
                        id: 'admin',
                        name: 'Administrator',
                        email: 'admin@vwashlaundry.co.ke',
                        phone: '+254 712 345 678',
                        password: 'admin123',
                        role: 'super_admin',
                        permissions: ['users', 'orders', 'services', 'admins', 'database', 'settings'],
                        status: 'active',
                        createdAt: new Date().toISOString()
                    };
                    
                    await app.db.add('admins', sampleAdmin);
                }
            } catch (error) {
                console.error('Error loading sample data:', error);
            }
            END OF COMMENTED OUT CODE */
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
